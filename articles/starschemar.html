<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="starschemar">
<title>starschemar: Obtaining Star Schemas from Flat Tables • starschemar</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="starschemar: Obtaining Star Schemas from Flat Tables">
<meta property="og:description" content="starschemar">
<meta property="og:image" content="https://josesamos.github.io/starschemar/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">starschemar</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.2.4.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item">
  <a class="nav-link" href="../articles/starschemar.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/v10_transformation_op.html">starschemar Transformation Operations</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/josesamos/starschemar/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>starschemar: Obtaining Star Schemas from Flat Tables</h1>
                        <h4 data-toc-skip class="author">Jose Samos (<a href="mailto:jsamos@ugr.es" class="email">jsamos@ugr.es</a>)</h4>
            
            <h4 data-toc-skip class="date">2020-09-24</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/josesamos/starschemar/blob/HEAD/vignettes/starschemar.Rmd" class="external-link"><code>vignettes/starschemar.Rmd</code></a></small>
      <div class="d-none name"><code>starschemar.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The <em>multidimensional data model</em> was defined in the 1990s
with the aim of supporting data analysis. Data in multidimensional
systems is obtained from operational systems and is transformed to adapt
it to the new structure.</p>
<p>Transformations can be carried out using professional ETL (extract,
transform and load) tools. Recently, tools aimed at end users have
emerged, which are also aimed at performing transformation operations.
All these tools are very useful to carry out the transformation process,
they provide a development environment to define the transformation
operations in a general way.</p>
<p>Frequently, the operations to be performed aim to transform a flat
table (with data that comes from operational systems) into a star schema
(which implements a multidimensional system). With the tools mentioned
above, this transformation can be carried out, but it requires a lot of
work.</p>
<p>This is the main objective of <code>starschemar</code> package:
Define <strong>transformations that allow obtaining star schemas from
flat tables</strong> easily. In addition, it includes basic data
cleaning operations, incremental data refresh operations and query
operations, adapted to this context.</p>
<p>The rest of this document is structured as follows: First, basic
concepts of dimensional modelling and star schemas are summarized. The
following is an illustrative example of how the package works. Finally,
the document ends with conclusions and bibliography.</p>
</div>
<div class="section level2">
<h2 id="dimensional-modelling-and-star-schemas">Dimensional modelling and star schemas<a class="anchor" aria-label="anchor" href="#dimensional-modelling-and-star-schemas"></a>
</h2>
<p>The content of this section is a summary based mainly on <span class="citation">Adamson (2010)</span> and <span class="citation">Kimball and Ross (2013)</span>. It is intended to
present the fundamental concepts of the area that are relevant to
understand the functionality, naming and use of the
<code>starschemar</code> package.</p>
<div class="section level3">
<h3 id="dimensional-modelling">Dimensional modelling<a class="anchor" aria-label="anchor" href="#dimensional-modelling"></a>
</h3>
<p>Dimensional modelling aims to obtain simple data models. Simplicity
is sought for two reasons: so that decision-makers can easily understand
the data, and also so that they can be easily queried.</p>
<p>In dimensional modelling, the analysis of a business process is
performed <em>modelling how it is measured</em>. The measures are called
<em>facts</em>, and the descriptors of the context of the facts are
<em>dimensions</em>. Facts are numerical data, and decision makers want
to see them at various levels of detail, defined by dimensions.</p>
<p>Not all numerical data is a fact (some tools consider it that way).
In dimensional modelling the designer has to differentiate between facts
and dimensions. Some criteria are considered to distinguish between
them, for example:</p>
<ul>
<li>If it can be defined at different levels of detail then it is a
fact.</li>
<li>If it is quantitative and takes continuous values, then it is a
fact.</li>
<li>If it provides context then it is a dimension.</li>
</ul>
<p>Sometimes there are no measures associated with the business process,
it is simply recorded that the combination of dimensions has occurred.
This situation is often called <em>factless facts</em>, <span class="citation">Jensen, Pedersen, and Thomsen (2010)</span> prefer to
call it <em>measureless facts</em>. In any case, including when no other
measures are available, a measure can be considered that represents the
number of times the combination of dimension values occurs.</p>
<div class="section level4">
<h4 id="dimensions-and-dimension-attributes">Dimensions and dimension attributes<a class="anchor" aria-label="anchor" href="#dimensions-and-dimension-attributes"></a>
</h4>
<p>Attributes considered by the designer as dimensions can be grouped
taking into account the natural affinities between them. In particular,
they can be grouped as they describe the “who, what, where, when, how
and why” associated with the modelled business process. Two attributes
share a natural affinity when they are only related in one context. When
their relationships are determined by transactions or activities, they
can occur in multiple contexts, if this occurs, they must be located in
different dimensions.</p>
<p>In this way, a <em>dimension</em> is made up of a set of naturally
related <em>dimension attributes</em> that describe the context of
facts. Dimensions are used for two purposes: fact <em>selection</em> and
fact <em>grouping</em> with the desired level of detail.</p>
<p>Additionally, in the dimensions <em>hierarchies</em> with
<em>levels</em> and <em>descriptors</em> can be defined. More details
can be found at <span class="citation">Jensen, Pedersen, and Thomsen
(2010)</span>. These concepts are not used in the current version of the
package.</p>
</div>
<div class="section level4">
<h4 id="facts-and-measures">Facts and measures<a class="anchor" aria-label="anchor" href="#facts-and-measures"></a>
</h4>
<p>A fact has a <em>granularity</em>, which is determined by the
attributes of the dimensions that are considered at each moment. Thus, a
measure in a fact has two components, the <em>numerical property</em> of
the fact and an <em>formula</em>, frequently the SUM aggregation
function, that allows combining several values of this measure to obtain
a new value of the same measure with a coarser granularity <span class="citation">(Jensen, Pedersen, and Thomsen 2010)</span>.</p>
<p>According to their behaviour to obtain a coarser granularity, three
types of measures are distinguished: additive, semi-additive and
non-additive. For <em>additive measures</em>, SUM is always a valid
formula that maintains the meaning of the measure when the granularity
changes. For <em>semi-additive measures</em>, there is no point in using
SUM when changing the level of detail in any of the dimensions because
the meaning of the measure changes, this frequently occurs in dimensions
that represents time and measures representing inventory level. For
<em>non-additive measures</em>, values cannot be combined across any
dimension using SUM because the result obtained has a different meaning
from the original measure (generally occurs with ratios, percentages or
unit amounts such as unit cost or unit price).</p>
<p>The most useful measures are additive. If we have non-additive
measures, they can generally be redefined from other additive
measures.</p>
</div>
</div>
<div class="section level3">
<h3 id="star-schemas">Star schemas<a class="anchor" aria-label="anchor" href="#star-schemas"></a>
</h3>
<p>Dimensional models implemented in RDBMS (Relational Database
Management Systems) using a table for each dimension are called <em>star
schemas</em> because of their resemblance to a star-like structure: A
<em>fact table</em> in the centre and <em>dimension tables</em> around
it. Thus, dimension attributes are columns of the respective dimension
tables, and measures are columns of the fact table.</p>
<p>Other possible implementations on RDBMS normalize dimensions and are
known as <em>snowflake schema</em>. More details can be found at <span class="citation">Jensen, Pedersen, and Thomsen (2010)</span>. This is
not considered in this package.</p>
<div class="section level4">
<h4 id="dimension-tables">Dimension tables<a class="anchor" aria-label="anchor" href="#dimension-tables"></a>
</h4>
<p>Dimension tables contain the context associated with business process
measures. Although they can contain any type of data, numerical data is
generally not used for dimension attributes because some query tools
consider any numeric data as a measure.</p>
<p>Dimension attributes with NULL value are a source of problems when
querying since DBMS and query tools sometimes handle them
inconsistently, the result depends on the product. It is recommended to
avoid the use of NULL and replace them with a descriptive text. In the
case of dates, it is recommended to replace the NULL values with an
arbitrary date in the very far future.</p>
<div class="section level5">
<h5 id="surrogate-keys">Surrogate keys<a class="anchor" aria-label="anchor" href="#surrogate-keys"></a>
</h5>
<p>A dimension table contains dimension attributes and also a
<em>surrogate key</em> column. This column is a unique identifier that
has no intrinsic meaning: It is generally an integer and is the primary
key for the dimension table. In <span class="citation">Adamson
(2010)</span> surrogate keys are easily identifiable by the suffix
“_key” in the column name (and this criterion has also been applied in
<code>starschemar</code> package).</p>
<p>Dimension tables also contain key columns that uniquely identify
associated entities in an operational system. The separation of
surrogate keys and natural keys allows the star schema to store changes
in dimensions. Therefore, the use of surrogate keys in dimensions is a
solution to the SCD (slowly changing dimensions) problem. This problem
is not specifically addressed in this version of this package.</p>
</div>
<div class="section level5">
<h5 id="special-dimensions">Special dimensions<a class="anchor" aria-label="anchor" href="#special-dimensions"></a>
</h5>
<p>In some cases, for the sake of simplicity, it is helpful to create a
table that contains dimension attributes that have no natural affinities
to each other, generally these are low-cardinality flags and indicators.
The result is what is known as a <em>junk dimension</em>. They do not
require any special support, only the designer’s will to define
them.</p>
<p>Sometimes some dimension attributes are left in the fact table,
usually transaction identifiers. It is considered as the primary key of
a dimension that does not have an associated table, for this reason it
is known as a <em>degenerate dimension</em>. Degenerate dimensions are
not allowed in this package.</p>
<p>A single dimension can be referenced multiple times in a fact table,
with each reference linked to a different logical role for each
dimension. These separate dimension views, with unique attribute column
names, are called <em>role dimensions</em> and the common dimension is
called a <em>role-playing dimension</em>.</p>
<p>Associated with multiple star schemas we have the <em>conformed
dimensions</em> that are presented in section <a href="#conformed-dimensions">Conformed dimensions</a>.</p>
</div>
</div>
<div class="section level4">
<h4 id="fact-table">Fact table<a class="anchor" aria-label="anchor" href="#fact-table"></a>
</h4>
<p>At the centre of a star schema is the fact table. In addition to
containing measures, the fact table includes foreign keys that refer to
each of the surrogate keys in the dimension tables.</p>
<div class="section level5">
<h5 id="primary-key">Primary key<a class="anchor" aria-label="anchor" href="#primary-key"></a>
</h5>
<p>A subset of foreign keys, along with possibly degenerate dimensions,
is considered to form the primary key of the fact table.</p>
<p>In <code>starschemar</code> package, since degenerate dimensions are
not allowed, the primary key is made up of a subset of foreign keys.</p>
</div>
<div class="section level5">
<h5 id="grain">Grain<a class="anchor" aria-label="anchor" href="#grain"></a>
</h5>
<p>The subset of dimensions that forms the primary key defines the level
of detail stored in the fact table, which is known as the fact table’s
<em>grain</em>. In the design process, it is very important for the
designer to clearly define the grain of the fact table (it is usually
defined by listing the dimensions whose surrogate keys form its primary
key): it is a way to ensure that all the facts are stored at the same
level of detail.</p>
<p>At the finest grain, a row in the fact table corresponds to the
measures of an event and vice versa, it is not influenced by the
possible reports that may be obtained. When two facts have different
grains, they should be set on different fact tables.</p>
</div>
</div>
<div class="section level4">
<h4 id="multiple-fact-tables">Multiple fact tables<a class="anchor" aria-label="anchor" href="#multiple-fact-tables"></a>
</h4>
<p>It is frequent the need to have several fact tables for various
reasons:</p>
<ul>
<li><p>We find measurements with different grain.</p></li>
<li><p>There are measures that do not occur simultaneously, for example,
when one occurs, we have no value for others and vice versa.</p></li>
</ul>
<p>In reality it is about different business processes, each one has to
have its own fact table but they have dimensions in common. This is
known as a <a href="https://www.geeksforgeeks.org/fact-constellation-in-data-warehouse-modelling/" class="external-link"><em>fact
constellation</em></a> which corresponds to the Kimball <em>enterprise
data warehouse bus architecture</em>.</p>
</div>
<div class="section level4">
<h4 id="conformed-dimensions">Conformed dimensions<a class="anchor" aria-label="anchor" href="#conformed-dimensions"></a>
</h4>
<p>When star schemas share a set of common dimensions, these dimensions
are called <em>conformed dimensions</em>.</p>
<p>There are several possibilities to have conformed dimensions, the
most obvious form is that the dimension tables share <em>structure</em>
and <em>content</em>, that is, they are identical dimensions. This is
the one considered in this version of the <code>starschemar</code>
package.</p>
</div>
</div>
<div class="section level3">
<h3 id="additional-operations">Additional operations<a class="anchor" aria-label="anchor" href="#additional-operations"></a>
</h3>
<div class="section level4">
<h4 id="cleaning-and-conforming-data">Cleaning and conforming data<a class="anchor" aria-label="anchor" href="#cleaning-and-conforming-data"></a>
</h4>
<p>When data is loaded into a star schema, errors or inconsistencies can
be discovered in some of them. In some cases, it is best to make
corrections at the source of the data, in operational systems. Sometimes
this is not possible and there is no other option but to modify the data
before loading it into the star schema or even when it is already
loaded.</p>
<p>Inconsistencies are often found in dimensions, when dimensions are
integrated into one, for example to generate a role-playing dimension or
conformed dimensions. Support for modifying dimension data is provided
in the package.</p>
</div>
<div class="section level4">
<h4 id="dimension-enrichment">Dimension enrichment<a class="anchor" aria-label="anchor" href="#dimension-enrichment"></a>
</h4>
<p>The more attributes the dimensions have, the more possibilities they
offer to filter or aggregate data. For this reason, it is convenient to
enrich the dimensions with new attributes, whenever possible. New
attributes are often defined based on existing ones. There must be a way
to associate the new attributes with the dimensions.</p>
<p>The more attributes the dimensions have, the more possibilities they
offer to filter or aggregate data. For this reason, it is convenient to
enrich the dimensions with new attributes, whenever possible. New
attributes are often defined based on existing ones. There must be a way
to associate the new attributes with the dimensions.</p>
<p>Operations have been defined in the package to export dimension
attributes so that their values are not repeated, and also to import
them, once the new attributes have been added.</p>
</div>
<div class="section level4">
<h4 id="incremental-refresh">Incremental refresh<a class="anchor" aria-label="anchor" href="#incremental-refresh"></a>
</h4>
<p>When a star schema is built, an initial load is performed with all
available data from a moment in time onwards.</p>
<p>Operational systems continue to operate and produce data. If we want
to incorporate these data into the star schema, we have two
possibilities:</p>
<ul>
<li><p>Carry out a new load with all the data available at that
time.</p></li>
<li><p>Perform an incremental refresh with only the new data.</p></li>
</ul>
<p>In order to carry out this second option, the CDC (change data
capture) system allows to exclusively obtain the new data produced.</p>
<p>Sometimes it is also convenient to delete data that is considered to
be no longer necessary, generally data from the more distant past.</p>
<p>In this package, it has been considered that we can obtain the new
data, possibly mixed with updates to data already incorporated into the
star schema, in order to carry out an incremental refresh of star
schemas with them. Operations are also offered to select data and delete
it if it is not considered necessary.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="an-illustrative-example">An illustrative example<a class="anchor" aria-label="anchor" href="#an-illustrative-example"></a>
</h2>
<div class="section level3">
<h3 id="starting-data-sets">Starting data sets<a class="anchor" aria-label="anchor" href="#starting-data-sets"></a>
</h3>
<p>To illustrate how the package works we will use a small part of the
<a href="https://catalog.data.gov/dataset/deaths-in-122-u-s-cities-1962-2016-122-cities-mortality-reporting-system" class="external-link">Deaths
in 122 U.S. cities - 1962-2016. 122 Cities Mortality Reporting
System</a> data set<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;I know this data set thanks to Alberto J. Duran, student
of &lt;em&gt;Multidimensional Systems&lt;/em&gt; during the 2019-2020 academic year,
a subject I teach at the University of Granada (Spain), for a work he
developed based on it, tutored by me.&lt;/p&gt;"><sup>1</sup></a>. Specifically, only the data for the first
11 weeks of 1962 are considered.</p>
<table class="table">
<colgroup>
<col width="2%">
<col width="2%">
<col width="7%">
<col width="3%">
<col width="3%">
<col width="5%">
<col width="13%">
<col width="5%">
<col width="11%">
<col width="12%">
<col width="5%">
<col width="13%">
<col width="13%">
</colgroup>
<thead><tr class="header">
<th align="center">Year</th>
<th align="center">WEEK</th>
<th align="center">Week Ending Date</th>
<th align="center">REGION</th>
<th align="center">State</th>
<th align="center">City</th>
<th align="center">Pneumonia and Influenza Deaths</th>
<th align="center">All Deaths</th>
<th align="center">&lt;1 year (all cause deaths)</th>
<th align="center">1-24 years (all cause deaths)</th>
<th align="center">25-44 years</th>
<th align="center">45-64 years (all cause deaths)</th>
<th align="center">65+ years (all cause deaths)</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">1962</td>
<td align="center">1</td>
<td align="center">1962-01-06</td>
<td align="center">1</td>
<td align="center">MA</td>
<td align="center">Boston</td>
<td align="center">11</td>
<td align="center">262</td>
<td align="center">10</td>
<td align="center">8</td>
<td align="center">11</td>
<td align="center">87</td>
<td align="center">146</td>
</tr>
<tr class="even">
<td align="center">1962</td>
<td align="center">2</td>
<td align="center">1962-01-13</td>
<td align="center">1</td>
<td align="center">MA</td>
<td align="center">Boston</td>
<td align="center">11</td>
<td align="center">270</td>
<td align="center">14</td>
<td align="center">8</td>
<td align="center">11</td>
<td align="center">70</td>
<td align="center">167</td>
</tr>
<tr class="odd">
<td align="center">1962</td>
<td align="center">3</td>
<td align="center">1962-01-20</td>
<td align="center">1</td>
<td align="center">MA</td>
<td align="center">Boston</td>
<td align="center">5</td>
<td align="center">237</td>
<td align="center">11</td>
<td align="center">8</td>
<td align="center">10</td>
<td align="center">66</td>
<td align="center">142</td>
</tr>
<tr class="even">
<td align="center">1962</td>
<td align="center">4</td>
<td align="center">1962-01-27</td>
<td align="center">1</td>
<td align="center">MA</td>
<td align="center">Boston</td>
<td align="center">12</td>
<td align="center">285</td>
<td align="center">22</td>
<td align="center">7</td>
<td align="center">8</td>
<td align="center">73</td>
<td align="center">175</td>
</tr>
<tr class="odd">
<td align="center">1962</td>
<td align="center">5</td>
<td align="center">1962-02-03</td>
<td align="center">1</td>
<td align="center">MA</td>
<td align="center">Boston</td>
<td align="center">5</td>
<td align="center">245</td>
<td align="center">15</td>
<td align="center">9</td>
<td align="center">17</td>
<td align="center">62</td>
<td align="center">142</td>
</tr>
<tr class="even">
<td align="center">1962</td>
<td align="center">6</td>
<td align="center">1962-02-10</td>
<td align="center">1</td>
<td align="center">MA</td>
<td align="center">Boston</td>
<td align="center">11</td>
<td align="center">284</td>
<td align="center">16</td>
<td align="center">8</td>
<td align="center">16</td>
<td align="center">79</td>
<td align="center">165</td>
</tr>
<tr class="odd">
<td align="center">1962</td>
<td align="center">7</td>
<td align="center">1962-02-17</td>
<td align="center">1</td>
<td align="center">MA</td>
<td align="center">Boston</td>
<td align="center">8</td>
<td align="center">227</td>
<td align="center">11</td>
<td align="center">7</td>
<td align="center">13</td>
<td align="center">71</td>
<td align="center">125</td>
</tr>
<tr class="even">
<td align="center">1962</td>
<td align="center">8</td>
<td align="center">1962-02-24</td>
<td align="center">1</td>
<td align="center">MA</td>
<td align="center">Boston</td>
<td align="center">10</td>
<td align="center">270</td>
<td align="center">14</td>
<td align="center">9</td>
<td align="center">10</td>
<td align="center">85</td>
<td align="center">152</td>
</tr>
<tr class="odd">
<td align="center">1962</td>
<td align="center">9</td>
<td align="center">1962-03-03</td>
<td align="center">1</td>
<td align="center">MA</td>
<td align="center">Boston</td>
<td align="center">16</td>
<td align="center">278</td>
<td align="center">15</td>
<td align="center">11</td>
<td align="center">15</td>
<td align="center">79</td>
<td align="center">158</td>
</tr>
<tr class="even">
<td align="center">1962</td>
<td align="center">10</td>
<td align="center">1962-03-10</td>
<td align="center">1</td>
<td align="center">MA</td>
<td align="center">Boston</td>
<td align="center">11</td>
<td align="center">297</td>
<td align="center">11</td>
<td align="center">7</td>
<td align="center">18</td>
<td align="center">80</td>
<td align="center">181</td>
</tr>
<tr class="odd">
<td align="center">1962</td>
<td align="center">11</td>
<td align="center">1962-03-17</td>
<td align="center">1</td>
<td align="center">MA</td>
<td align="center">Boston</td>
<td align="center">16</td>
<td align="center">290</td>
<td align="center">16</td>
<td align="center">7</td>
<td align="center">21</td>
<td align="center">74</td>
<td align="center">172</td>
</tr>
<tr class="even">
<td align="center">1962</td>
<td align="center">1</td>
<td align="center">1962-01-06</td>
<td align="center">1</td>
<td align="center">CT</td>
<td align="center">Bridgeport</td>
<td align="center">3</td>
<td align="center">46</td>
<td align="center">3</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">16</td>
<td align="center">27</td>
</tr>
</tbody>
</table>
<p>In the table above, the first rows of the original data are shown.
For each week and city, mortality figures by age group and cause,
considered separately, are included (i.e., the combination of age group
and cause is not included). In the cause, only a distinction is made
between pneumonia or influenza and others.</p>
<p>It can be seen that there is only one measure, <em>deaths</em>,
defined at two different granularities: <em>week-city-cause</em> (data
in columns “Pneumonia and Influenza Deaths” and “All Deaths”) and
<em>week-city-age bracket</em> (data from the 5 columns on the right).
This means that we will need <strong>two fact tables</strong> to include
all the data in star schemas.</p>
<p>As the data is partially in the form of a pivot table, from these
data two tables have been generated<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;The transformation has been carried out with &lt;a href="https://CRAN.R-project.org/package=tidyverse" class="external-link"&gt;&lt;code&gt;tidyverse&lt;/code&gt;&lt;/a&gt;
and &lt;a href="https://CRAN.R-project.org/package=flattabler" class="external-link"&gt;&lt;code&gt;flattabler&lt;/code&gt;&lt;/a&gt;
packages.&lt;/p&gt;'><sup>2</sup></a>, one for each granularity. Additionally,
the following operations have been carried out:</p>
<ul>
<li><p>To show the incremental refresh, the data has been selected: On
the one hand, the first 9 weeks were considered, and on the other, each
of the following weeks separately.</p></li>
<li><p>To show the possibilities of data modification operations to
correct errors, some data has been modified to generate missing data or
errors.</p></li>
</ul>
<table class="table">
<colgroup>
<col width="8%">
<col width="8%">
<col width="23%">
<col width="10%">
<col width="9%">
<col width="10%">
<col width="17%">
<col width="10%">
</colgroup>
<thead><tr class="header">
<th align="center">Year</th>
<th align="center">WEEK</th>
<th align="center">Week Ending Date</th>
<th align="center">REGION</th>
<th align="center">State</th>
<th align="center">City</th>
<th align="center">Age Range</th>
<th align="center">Deaths</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">1962</td>
<td align="center">1</td>
<td align="center">1962-01-06</td>
<td align="center">1</td>
<td align="center">MA</td>
<td align="center">Boston</td>
<td align="center">&lt;1 year</td>
<td align="center">10</td>
</tr>
<tr class="even">
<td align="center">1962</td>
<td align="center">1</td>
<td align="center">1962-01-06</td>
<td align="center">1</td>
<td align="center">MA</td>
<td align="center">Boston</td>
<td align="center">1-24 years</td>
<td align="center">8</td>
</tr>
<tr class="odd">
<td align="center">1962</td>
<td align="center">1</td>
<td align="center">1962-01-06</td>
<td align="center">1</td>
<td align="center">MA</td>
<td align="center">Boston</td>
<td align="center">25-44 years</td>
<td align="center">11</td>
</tr>
<tr class="even">
<td align="center">1962</td>
<td align="center">1</td>
<td align="center">1962-01-06</td>
<td align="center">1</td>
<td align="center">MA</td>
<td align="center">Boston</td>
<td align="center">45-64 years</td>
<td align="center">87</td>
</tr>
<tr class="odd">
<td align="center">1962</td>
<td align="center">1</td>
<td align="center">1962-01-06</td>
<td align="center">1</td>
<td align="center">MA</td>
<td align="center">Boston</td>
<td align="center">65+ years</td>
<td align="center">146</td>
</tr>
<tr class="even">
<td align="center">1962</td>
<td align="center">2</td>
<td align="center">1962-01-13</td>
<td align="center">1</td>
<td align="center">MA</td>
<td align="center">Boston</td>
<td align="center">&lt;1 year</td>
<td align="center">14</td>
</tr>
</tbody>
</table>
<p>In the table above, the first rows of the flat table that contains
the data according to the age bracket are shown.</p>
<p>The following table shows the first 18 rows of the flat table
containing data based on cause of death. The calculated column <em>Other
Deaths</em> has been added. Here you can see some missing data (columns
<em>Year</em> and <em>WEEK</em>), errors (value “Bridgepor” in column
<em>City</em>) and how there are only data from the first 9 weeks.</p>
<table class="table">
<colgroup>
<col width="5%">
<col width="5%">
<col width="15%">
<col width="7%">
<col width="6%">
<col width="10%">
<col width="26%">
<col width="10%">
<col width="12%">
</colgroup>
<thead><tr class="header">
<th align="center">Year</th>
<th align="center">WEEK</th>
<th align="center">Week Ending Date</th>
<th align="center">REGION</th>
<th align="center">State</th>
<th align="center">City</th>
<th align="center">Pneumonia and Influenza Deaths</th>
<th align="center">All Deaths</th>
<th align="center">Other Deaths</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">1962</td>
<td align="center">1</td>
<td align="center">1962-01-06</td>
<td align="center">1</td>
<td align="center">MA</td>
<td align="center">Boston</td>
<td align="center">11</td>
<td align="center">262</td>
<td align="center">251</td>
</tr>
<tr class="even">
<td align="center">1962</td>
<td align="center">2</td>
<td align="center">1962-01-13</td>
<td align="center">1</td>
<td align="center">MA</td>
<td align="center">Boston</td>
<td align="center">11</td>
<td align="center">270</td>
<td align="center">259</td>
</tr>
<tr class="odd">
<td align="center">1962</td>
<td align="center">3</td>
<td align="center">1962-01-20</td>
<td align="center">1</td>
<td align="center">MA</td>
<td align="center">Boston</td>
<td align="center">5</td>
<td align="center">237</td>
<td align="center">232</td>
</tr>
<tr class="even">
<td align="center">1962</td>
<td align="center">4</td>
<td align="center">1962-01-27</td>
<td align="center">1</td>
<td align="center">MA</td>
<td align="center">Boston</td>
<td align="center">12</td>
<td align="center">285</td>
<td align="center">273</td>
</tr>
<tr class="odd">
<td align="center">1962</td>
<td align="center">5</td>
<td align="center">1962-02-03</td>
<td align="center">1</td>
<td align="center">MA</td>
<td align="center">Boston</td>
<td align="center">5</td>
<td align="center">245</td>
<td align="center">240</td>
</tr>
<tr class="even">
<td align="center">NA</td>
<td align="center">NA</td>
<td align="center">1962-02-10</td>
<td align="center">1</td>
<td align="center">MA</td>
<td align="center">Boston</td>
<td align="center">11</td>
<td align="center">284</td>
<td align="center">273</td>
</tr>
<tr class="odd">
<td align="center">1962</td>
<td align="center">7</td>
<td align="center">1962-02-17</td>
<td align="center">1</td>
<td align="center">MA</td>
<td align="center">Boston</td>
<td align="center">8</td>
<td align="center">227</td>
<td align="center">219</td>
</tr>
<tr class="even">
<td align="center">1962</td>
<td align="center">8</td>
<td align="center">1962-02-24</td>
<td align="center">1</td>
<td align="center">MA</td>
<td align="center">Boston</td>
<td align="center">10</td>
<td align="center">270</td>
<td align="center">260</td>
</tr>
<tr class="odd">
<td align="center">1962</td>
<td align="center">9</td>
<td align="center">1962-03-03</td>
<td align="center">1</td>
<td align="center">MA</td>
<td align="center">Boston</td>
<td align="center">16</td>
<td align="center">278</td>
<td align="center">262</td>
</tr>
<tr class="even">
<td align="center">1962</td>
<td align="center">1</td>
<td align="center">1962-01-06</td>
<td align="center">1</td>
<td align="center">CT</td>
<td align="center">Bridgeport</td>
<td align="center">3</td>
<td align="center">46</td>
<td align="center">43</td>
</tr>
<tr class="odd">
<td align="center">1962</td>
<td align="center">2</td>
<td align="center">1962-01-13</td>
<td align="center">1</td>
<td align="center">CT</td>
<td align="center">Bridgeport</td>
<td align="center">2</td>
<td align="center">43</td>
<td align="center">41</td>
</tr>
<tr class="even">
<td align="center">1962</td>
<td align="center">3</td>
<td align="center">1962-01-20</td>
<td align="center">1</td>
<td align="center">CT</td>
<td align="center">Bridgeport</td>
<td align="center">2</td>
<td align="center">40</td>
<td align="center">38</td>
</tr>
<tr class="odd">
<td align="center">1962</td>
<td align="center">4</td>
<td align="center">1962-01-27</td>
<td align="center">1</td>
<td align="center">CT</td>
<td align="center">Bridgeport</td>
<td align="center">4</td>
<td align="center">46</td>
<td align="center">42</td>
</tr>
<tr class="even">
<td align="center">1962</td>
<td align="center">5</td>
<td align="center">1962-02-03</td>
<td align="center">1</td>
<td align="center">CT</td>
<td align="center">Bridgeport</td>
<td align="center">5</td>
<td align="center">46</td>
<td align="center">41</td>
</tr>
<tr class="odd">
<td align="center">1962</td>
<td align="center">6</td>
<td align="center">1962-02-10</td>
<td align="center">1</td>
<td align="center">CT</td>
<td align="center">Bridgeport</td>
<td align="center">3</td>
<td align="center">42</td>
<td align="center">39</td>
</tr>
<tr class="even">
<td align="center">1962</td>
<td align="center">7</td>
<td align="center">1962-02-17</td>
<td align="center">1</td>
<td align="center">CT</td>
<td align="center">Bridgeport</td>
<td align="center">1</td>
<td align="center">35</td>
<td align="center">34</td>
</tr>
<tr class="odd">
<td align="center">1962</td>
<td align="center">8</td>
<td align="center">1962-02-24</td>
<td align="center">1</td>
<td align="center">CT</td>
<td align="center">Bridgeport</td>
<td align="center">2</td>
<td align="center">45</td>
<td align="center">43</td>
</tr>
<tr class="even">
<td align="center">1962</td>
<td align="center">9</td>
<td align="center">1962-03-03</td>
<td align="center">1</td>
<td align="center">CT</td>
<td align="center">Bridgepor</td>
<td align="center">3</td>
<td align="center">46</td>
<td align="center">43</td>
</tr>
</tbody>
</table>
<p>To have more layout possibilities to display, new columns with dates
have been generated. Next, in both tables, the new columns related to
the date that have been added can be seen.</p>
<table style="width:100%;" class="table">
<colgroup>
<col width="8%">
<col width="8%">
<col width="8%">
<col width="12%">
<col width="12%">
<col width="12%">
<col width="3%">
<col width="3%">
<col width="9%">
<col width="4%">
<col width="3%">
<col width="4%">
<col width="6%">
<col width="4%">
</colgroup>
<thead><tr class="header">
<th align="center">Reception Year</th>
<th align="center">Reception Week</th>
<th align="center">Reception Date</th>
<th align="center">Data Availability Year</th>
<th align="center">Data Availability Week</th>
<th align="center">Data Availability Date</th>
<th align="center">Year</th>
<th align="center">WEEK</th>
<th align="center">Week Ending Date</th>
<th align="center">REGION</th>
<th align="center">State</th>
<th align="center">City</th>
<th align="center">Age Range</th>
<th align="center">Deaths</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">1962</td>
<td align="center">2</td>
<td align="center">1962-01-10</td>
<td align="center">1962</td>
<td align="center">3</td>
<td align="center">1962-01-19</td>
<td align="center">1962</td>
<td align="center">1</td>
<td align="center">1962-01-06</td>
<td align="center">1</td>
<td align="center">MA</td>
<td align="center">Boston</td>
<td align="center">&lt;1 year</td>
<td align="center">10</td>
</tr>
<tr class="even">
<td align="center">1962</td>
<td align="center">2</td>
<td align="center">1962-01-10</td>
<td align="center">1962</td>
<td align="center">3</td>
<td align="center">1962-01-19</td>
<td align="center">1962</td>
<td align="center">1</td>
<td align="center">1962-01-06</td>
<td align="center">1</td>
<td align="center">MA</td>
<td align="center">Boston</td>
<td align="center">1-24 years</td>
<td align="center">8</td>
</tr>
<tr class="odd">
<td align="center">1962</td>
<td align="center">2</td>
<td align="center">1962-01-10</td>
<td align="center">1962</td>
<td align="center">3</td>
<td align="center">1962-01-19</td>
<td align="center">1962</td>
<td align="center">1</td>
<td align="center">1962-01-06</td>
<td align="center">1</td>
<td align="center">MA</td>
<td align="center">Boston</td>
<td align="center">25-44 years</td>
<td align="center">11</td>
</tr>
<tr class="even">
<td align="center">1962</td>
<td align="center">2</td>
<td align="center">1962-01-10</td>
<td align="center">1962</td>
<td align="center">3</td>
<td align="center">1962-01-19</td>
<td align="center">1962</td>
<td align="center">1</td>
<td align="center">1962-01-06</td>
<td align="center">1</td>
<td align="center">MA</td>
<td align="center">Boston</td>
<td align="center">45-64 years</td>
<td align="center">87</td>
</tr>
<tr class="odd">
<td align="center">1962</td>
<td align="center">2</td>
<td align="center">1962-01-10</td>
<td align="center">1962</td>
<td align="center">3</td>
<td align="center">1962-01-19</td>
<td align="center">1962</td>
<td align="center">1</td>
<td align="center">1962-01-06</td>
<td align="center">1</td>
<td align="center">MA</td>
<td align="center">Boston</td>
<td align="center">65+ years</td>
<td align="center">146</td>
</tr>
<tr class="even">
<td align="center">1962</td>
<td align="center">3</td>
<td align="center">1962-01-16</td>
<td align="center">1962</td>
<td align="center">3</td>
<td align="center">1962-01-18</td>
<td align="center">1962</td>
<td align="center">2</td>
<td align="center">1962-01-13</td>
<td align="center">1</td>
<td align="center">MA</td>
<td align="center">Boston</td>
<td align="center">&lt;1 year</td>
<td align="center">14</td>
</tr>
</tbody>
</table>
<table class="table">
<colgroup>
<col width="6%">
<col width="6%">
<col width="6%">
<col width="10%">
<col width="10%">
<col width="10%">
<col width="2%">
<col width="2%">
<col width="7%">
<col width="3%">
<col width="3%">
<col width="3%">
<col width="13%">
<col width="5%">
<col width="6%">
</colgroup>
<thead><tr class="header">
<th align="center">Reception Year</th>
<th align="center">Reception Week</th>
<th align="center">Reception Date</th>
<th align="center">Data Availability Year</th>
<th align="center">Data Availability Week</th>
<th align="center">Data Availability Date</th>
<th align="center">Year</th>
<th align="center">WEEK</th>
<th align="center">Week Ending Date</th>
<th align="center">REGION</th>
<th align="center">State</th>
<th align="center">City</th>
<th align="center">Pneumonia and Influenza Deaths</th>
<th align="center">All Deaths</th>
<th align="center">Other Deaths</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">1962</td>
<td align="center">2</td>
<td align="center">1962-01-10</td>
<td align="center">1962</td>
<td align="center">3</td>
<td align="center">1962-01-19</td>
<td align="center">1962</td>
<td align="center">1</td>
<td align="center">1962-01-06</td>
<td align="center">1</td>
<td align="center">MA</td>
<td align="center">Boston</td>
<td align="center">11</td>
<td align="center">262</td>
<td align="center">251</td>
</tr>
<tr class="even">
<td align="center">1962</td>
<td align="center">3</td>
<td align="center">1962-01-16</td>
<td align="center">1962</td>
<td align="center">3</td>
<td align="center">1962-01-18</td>
<td align="center">1962</td>
<td align="center">2</td>
<td align="center">1962-01-13</td>
<td align="center">1</td>
<td align="center">MA</td>
<td align="center">Boston</td>
<td align="center">11</td>
<td align="center">270</td>
<td align="center">259</td>
</tr>
<tr class="odd">
<td align="center">1962</td>
<td align="center">4</td>
<td align="center">1962-01-23</td>
<td align="center">1962</td>
<td align="center">4</td>
<td align="center">1962-01-25</td>
<td align="center">1962</td>
<td align="center">3</td>
<td align="center">1962-01-20</td>
<td align="center">1</td>
<td align="center">MA</td>
<td align="center">Boston</td>
<td align="center">5</td>
<td align="center">237</td>
<td align="center">232</td>
</tr>
<tr class="even">
<td align="center">1962</td>
<td align="center">4</td>
<td align="center">1962-01-27</td>
<td align="center">1962</td>
<td align="center">6</td>
<td align="center">1962-02-07</td>
<td align="center">1962</td>
<td align="center">4</td>
<td align="center">1962-01-27</td>
<td align="center">1</td>
<td align="center">MA</td>
<td align="center">Boston</td>
<td align="center">12</td>
<td align="center">285</td>
<td align="center">273</td>
</tr>
<tr class="odd">
<td align="center">1962</td>
<td align="center">6</td>
<td align="center">1962-02-08</td>
<td align="center">1962</td>
<td align="center">7</td>
<td align="center">1962-02-14</td>
<td align="center">1962</td>
<td align="center">5</td>
<td align="center">1962-02-03</td>
<td align="center">1</td>
<td align="center">MA</td>
<td align="center">Boston</td>
<td align="center">5</td>
<td align="center">245</td>
<td align="center">240</td>
</tr>
<tr class="even">
<td align="center">1962</td>
<td align="center">6</td>
<td align="center">1962-02-10</td>
<td align="center">1962</td>
<td align="center">7</td>
<td align="center">1962-02-12</td>
<td align="center">NA</td>
<td align="center">NA</td>
<td align="center">1962-02-10</td>
<td align="center">1</td>
<td align="center">MA</td>
<td align="center">Boston</td>
<td align="center">11</td>
<td align="center">284</td>
<td align="center">273</td>
</tr>
</tbody>
</table>
<p>These are the flat tables that will be considered as a starting point
to obtain star schemas from them in this example. They are available in
the package: <code>mrs_age</code> and <code>mrs_cause</code>
respectively.</p>
</div>
<div class="section level3">
<h3 id="dimensional-modelling-1">Dimensional modelling<a class="anchor" aria-label="anchor" href="#dimensional-modelling-1"></a>
</h3>
<p>For each flat table, the goal is to define the attributes that
correspond to facts and those that are dimensions. For facts, measures
and their aggregation functions have to be defined. For dimensions,
attributes with natural affinity must be grouped. Each attribute can
only appear once in the definition.</p>
<div class="section level4">
<h4 id="dimensional-modelling-data-according-to-age-range">Dimensional modelling data according to age range<a class="anchor" aria-label="anchor" href="#dimensional-modelling-data-according-to-age-range"></a>
</h4>
<p>To avoid having to write the name of the attributes of the table,
with the following function we can have them in the form of a string.
Thus, we can copy and paste each name as needed.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/dput.html" class="external-link">dput</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">mrs_age</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; c("Reception Year", "Reception Week", "Reception Date", "Data Availability Year", </span></span>
<span><span class="co">#&gt; "Data Availability Week", "Data Availability Date", "Year", "WEEK", </span></span>
<span><span class="co">#&gt; "Week Ending Date", "REGION", "State", "City", "Age Range", "Deaths"</span></span>
<span><span class="co">#&gt; )</span></span></code></pre></div>
<p>The definition of the dimensional model for the data considered is
shown below.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://josesamos.github.io/starschemar/">starschemar</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">dm_mrs_age</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dimensional_model.html">dimensional_model</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/define_fact.html">define_fact</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="st">"mrs_age"</span>,</span>
<span>    measures <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>      <span class="st">"Deaths"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    agg_functions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>      <span class="st">"SUM"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    nrow_agg <span class="op">=</span> <span class="st">"nrow_agg"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/define_dimension.html">define_dimension</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="st">"when"</span>,</span>
<span>    attributes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>      <span class="st">"Week Ending Date"</span>,</span>
<span>      <span class="st">"WEEK"</span>,</span>
<span>      <span class="st">"Year"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/define_dimension.html">define_dimension</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="st">"when_available"</span>,</span>
<span>    attributes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>      <span class="st">"Data Availability Date"</span>,</span>
<span>      <span class="st">"Data Availability Week"</span>,</span>
<span>      <span class="st">"Data Availability Year"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/define_dimension.html">define_dimension</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="st">"where"</span>,</span>
<span>    attributes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>      <span class="st">"REGION"</span>,</span>
<span>      <span class="st">"State"</span>,</span>
<span>      <span class="st">"City"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/define_dimension.html">define_dimension</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="st">"who"</span>,</span>
<span>    attributes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>      <span class="st">"Age Range"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>In this case, all the elements have been explicitly defined,
including aggregation functions and the name of an additional measure
representing the number of rows aggregated, which is always included.
Only data from two of the three possible time-related dimensions have
been considered.</p>
</div>
<div class="section level4">
<h4 id="dimensional-modelling-data-according-to-cause">Dimensional modelling data according to cause<a class="anchor" aria-label="anchor" href="#dimensional-modelling-data-according-to-cause"></a>
</h4>
<p>In the case of data according to cause of death, the definition of
the model is shown below.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dm_mrs_cause</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dimensional_model.html">dimensional_model</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/define_fact.html">define_fact</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="st">"mrs_cause"</span>,</span>
<span>    measures <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>      <span class="st">"Pneumonia and Influenza Deaths"</span>,</span>
<span>      <span class="st">"Other Deaths"</span></span>
<span>    <span class="op">)</span>,</span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/define_dimension.html">define_dimension</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="st">"when"</span>,</span>
<span>    attributes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>      <span class="st">"Week Ending Date"</span>,</span>
<span>      <span class="st">"WEEK"</span>,</span>
<span>      <span class="st">"Year"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/define_dimension.html">define_dimension</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="st">"when_received"</span>,</span>
<span>    attributes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>      <span class="st">"Reception Date"</span>,</span>
<span>      <span class="st">"Reception Week"</span>,</span>
<span>      <span class="st">"Reception Year"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/define_dimension.html">define_dimension</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="st">"when_available"</span>,</span>
<span>    attributes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>      <span class="st">"Data Availability Date"</span>,</span>
<span>      <span class="st">"Data Availability Week"</span>,</span>
<span>      <span class="st">"Data Availability Year"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/define_dimension.html">define_dimension</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="st">"where"</span>,</span>
<span>    attributes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>      <span class="st">"REGION"</span>,</span>
<span>      <span class="st">"State"</span>,</span>
<span>      <span class="st">"City"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>If no aggregation function is indicated, by default, SUM is
considered. Although not explicitly stated, it also includes by default
the measure relative to the number of rows aggregated. In this case, the
three dimensions related to the date have been defined.</p>
</div>
</div>
<div class="section level3">
<h3 id="star-schema-definition-and-transformation-constellations">Star schema definition and transformation: Constellations<a class="anchor" aria-label="anchor" href="#star-schema-definition-and-transformation-constellations"></a>
</h3>
<p>To define a star schema, we need a flat table and a dimensional model
defined from it. Once defined, we can apply format modification
operations to it.</p>
<div class="section level4">
<h4 id="star-schema-definition-for-data-according-to-age-range">Star schema definition for data according to age range<a class="anchor" aria-label="anchor" href="#star-schema-definition-for-data-according-to-age-range"></a>
</h4>
<p>The basic definition operation of a star schema is shown below<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;&lt;code&gt;SaveRDS&lt;/code&gt; and &lt;code&gt;readRDS&lt;/code&gt; functions
can be used to save and retrieve star schemas or any other defined data
structure.&lt;/p&gt;"><sup>3</sup></a>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">st_mrs_age</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/star_schema.html">star_schema</a></span><span class="op">(</span><span class="va">mrs_age</span>, <span class="va">dm_mrs_age</span><span class="op">)</span></span></code></pre></div>
<p>The first rows of the obtained dimension and fact tables are shown
below.</p>
<table style="width:61%;" class="table">
<colgroup>
<col width="15%">
<col width="26%">
<col width="9%">
<col width="9%">
</colgroup>
<thead><tr class="header">
<th align="center">when_key</th>
<th align="center">Week Ending Date</th>
<th align="center">WEEK</th>
<th align="center">Year</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">1</td>
<td align="center">1962-01-06</td>
<td align="center">1</td>
<td align="center">1962</td>
</tr>
<tr class="even">
<td align="center">2</td>
<td align="center">1962-01-13</td>
<td align="center">2</td>
<td align="center">1962</td>
</tr>
<tr class="odd">
<td align="center">3</td>
<td align="center">1962-01-20</td>
<td align="center">3</td>
<td align="center">1962</td>
</tr>
<tr class="even">
<td align="center">4</td>
<td align="center">1962-01-27</td>
<td align="center">4</td>
<td align="center">1962</td>
</tr>
<tr class="odd">
<td align="center">5</td>
<td align="center">1962-02-03</td>
<td align="center">5</td>
<td align="center">1962</td>
</tr>
<tr class="even">
<td align="center">6</td>
<td align="center">1962-02-10</td>
<td align="center">6</td>
<td align="center">1962</td>
</tr>
</tbody>
</table>
<table class="table">
<colgroup>
<col width="21%">
<col width="26%">
<col width="26%">
<col width="26%">
</colgroup>
<thead><tr class="header">
<th align="center">when_available_key</th>
<th align="center">Data Availability Date</th>
<th align="center">Data Availability Week</th>
<th align="center">Data Availability Year</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">1</td>
<td align="center">1962-01-06</td>
<td align="center">1</td>
<td align="center">1962</td>
</tr>
<tr class="even">
<td align="center">2</td>
<td align="center">1962-01-07</td>
<td align="center">1</td>
<td align="center">1962</td>
</tr>
<tr class="odd">
<td align="center">3</td>
<td align="center">1962-01-08</td>
<td align="center">2</td>
<td align="center">1962</td>
</tr>
<tr class="even">
<td align="center">4</td>
<td align="center">1962-01-09</td>
<td align="center">2</td>
<td align="center">1962</td>
</tr>
<tr class="odd">
<td align="center">5</td>
<td align="center">1962-01-10</td>
<td align="center">2</td>
<td align="center">1962</td>
</tr>
<tr class="even">
<td align="center">6</td>
<td align="center">1962-01-11</td>
<td align="center">2</td>
<td align="center">1962</td>
</tr>
</tbody>
</table>
<table style="width:58%;" class="table">
<colgroup>
<col width="16%">
<col width="12%">
<col width="11%">
<col width="18%">
</colgroup>
<thead><tr class="header">
<th align="center">where_key</th>
<th align="center">REGION</th>
<th align="center">State</th>
<th align="center">City</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">1</td>
<td align="center">1</td>
<td align="center">CT</td>
<td align="center">Bridgepor</td>
</tr>
<tr class="even">
<td align="center">2</td>
<td align="center">1</td>
<td align="center">CT</td>
<td align="center">Bridgeport</td>
</tr>
<tr class="odd">
<td align="center">3</td>
<td align="center">1</td>
<td align="center">CT</td>
<td align="center">Hartford</td>
</tr>
<tr class="even">
<td align="center">4</td>
<td align="center">1</td>
<td align="center">CT</td>
<td align="center">New Haven</td>
</tr>
<tr class="odd">
<td align="center">5</td>
<td align="center">1</td>
<td align="center">CT</td>
<td align="center">Waterbury</td>
</tr>
<tr class="even">
<td align="center">6</td>
<td align="center">1</td>
<td align="center">MA</td>
<td align="center">Boston</td>
</tr>
</tbody>
</table>
<table style="width:33%;" class="table">
<colgroup>
<col width="13%">
<col width="19%">
</colgroup>
<thead><tr class="header">
<th align="center">who_key</th>
<th align="center">Age Range</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">1</td>
<td align="center">1-24 years</td>
</tr>
<tr class="even">
<td align="center">2</td>
<td align="center">25-44 years</td>
</tr>
<tr class="odd">
<td align="center">3</td>
<td align="center">45-64 years</td>
</tr>
<tr class="even">
<td align="center">4</td>
<td align="center">65+ years</td>
</tr>
<tr class="odd">
<td align="center">5</td>
<td align="center">&lt;1 year</td>
</tr>
</tbody>
</table>
<table class="table">
<colgroup>
<col width="14%">
<col width="28%">
<col width="16%">
<col width="13%">
<col width="12%">
<col width="14%">
</colgroup>
<thead><tr class="header">
<th align="center">when_key</th>
<th align="center">when_available_key</th>
<th align="center">where_key</th>
<th align="center">who_key</th>
<th align="center">Deaths</th>
<th align="center">nrow_agg</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">1</td>
<td align="center">1</td>
<td align="center">7</td>
<td align="center">2</td>
<td align="center">3</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">1</td>
<td align="center">1</td>
<td align="center">7</td>
<td align="center">3</td>
<td align="center">13</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">1</td>
<td align="center">1</td>
<td align="center">7</td>
<td align="center">4</td>
<td align="center">20</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">1</td>
<td align="center">1</td>
<td align="center">7</td>
<td align="center">5</td>
<td align="center">2</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">1</td>
<td align="center">1</td>
<td align="center">21</td>
<td align="center">1</td>
<td align="center">2</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">1</td>
<td align="center">1</td>
<td align="center">21</td>
<td align="center">2</td>
<td align="center">3</td>
<td align="center">1</td>
</tr>
</tbody>
</table>
<p>The data from the original flat table has been structured in the form
of dimension tables and fact tables. Data in the columns of the original
table included in the dimensions is not repeated. A surrogate key has
been added to each of the dimension tables that are foreign keys in the
fact table.</p>
<p>Next, we will apply format modification operations to the original
structure obtained.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">st_mrs_age</span> <span class="op">&lt;-</span> <span class="va">st_mrs_age</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/role_playing_dimension.html">role_playing_dimension</a></span><span class="op">(</span></span>
<span>    dim_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"when"</span>, <span class="st">"when_available"</span><span class="op">)</span>,</span>
<span>    name <span class="op">=</span> <span class="st">"When Common"</span>,</span>
<span>    attributes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"date"</span>, <span class="st">"week"</span>, <span class="st">"year"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/snake_case.html">snake_case</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/character_dimensions.html">character_dimensions</a></span><span class="op">(</span>NA_replacement_value <span class="op">=</span> <span class="st">"Unknown"</span>,</span>
<span>                       length_integers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>week <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>First, a role playing dimension has been defined based on the
dimensions related to dates. Then, to work with databases, the names
have been adapted to the snake case criterion. Finally, the data type of
the attributes of the dimensions has been transformed so that all
columns except the date columns are of the character data type, in the
case of numerical data, it is allowed to indicate the length of the
field to fill with leading zeros, and undefined values have been
replaced by the indicated value.</p>
<p>The first rows of the new dimension and fact tables are shown
below.</p>
<table style="width:83%;" class="table">
<colgroup>
<col width="20%">
<col width="31%">
<col width="15%">
<col width="15%">
</colgroup>
<tbody><tr class="odd">
<td align="center"><strong>when_key</strong></td>
<td align="center"><strong>week_ending_date</strong></td>
<td align="center"><strong>week</strong></td>
<td align="center"><strong>year</strong></td>
</tr></tbody>
</table>
<table class="table">
<colgroup>
<col width="22%">
<col width="25%">
<col width="25%">
<col width="25%">
</colgroup>
<tbody><tr class="odd">
<td align="center"><strong>when_available_key</strong></td>
<td align="center"><strong>data_availability_date</strong></td>
<td align="center"><strong>data_availability_week</strong></td>
<td align="center"><strong>data_availability_year</strong></td>
</tr></tbody>
</table>
<table style="width:58%;" class="table">
<colgroup>
<col width="16%">
<col width="12%">
<col width="11%">
<col width="18%">
</colgroup>
<thead><tr class="header">
<th align="center">where_key</th>
<th align="center">region</th>
<th align="center">state</th>
<th align="center">city</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">1</td>
<td align="center">1</td>
<td align="center">CT</td>
<td align="center">Bridgepor</td>
</tr>
<tr class="even">
<td align="center">2</td>
<td align="center">1</td>
<td align="center">CT</td>
<td align="center">Bridgeport</td>
</tr>
<tr class="odd">
<td align="center">3</td>
<td align="center">1</td>
<td align="center">CT</td>
<td align="center">Hartford</td>
</tr>
<tr class="even">
<td align="center">4</td>
<td align="center">1</td>
<td align="center">CT</td>
<td align="center">New Haven</td>
</tr>
<tr class="odd">
<td align="center">5</td>
<td align="center">1</td>
<td align="center">CT</td>
<td align="center">Waterbury</td>
</tr>
<tr class="even">
<td align="center">6</td>
<td align="center">1</td>
<td align="center">MA</td>
<td align="center">Boston</td>
</tr>
</tbody>
</table>
<table style="width:33%;" class="table">
<colgroup>
<col width="13%">
<col width="19%">
</colgroup>
<thead><tr class="header">
<th align="center">who_key</th>
<th align="center">age_range</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">1</td>
<td align="center">1-24 years</td>
</tr>
<tr class="even">
<td align="center">2</td>
<td align="center">25-44 years</td>
</tr>
<tr class="odd">
<td align="center">3</td>
<td align="center">45-64 years</td>
</tr>
<tr class="even">
<td align="center">4</td>
<td align="center">65+ years</td>
</tr>
<tr class="odd">
<td align="center">5</td>
<td align="center">&lt;1 year</td>
</tr>
</tbody>
</table>
<table style="width:62%;" class="table">
<colgroup>
<col width="25%">
<col width="18%">
<col width="9%">
<col width="9%">
</colgroup>
<thead><tr class="header">
<th align="center">when_common_key</th>
<th align="center">date</th>
<th align="center">week</th>
<th align="center">year</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">1</td>
<td align="center">1962-01-06</td>
<td align="center">01</td>
<td align="center">1962</td>
</tr>
<tr class="even">
<td align="center">2</td>
<td align="center">1962-01-07</td>
<td align="center">01</td>
<td align="center">1962</td>
</tr>
<tr class="odd">
<td align="center">3</td>
<td align="center">1962-01-08</td>
<td align="center">02</td>
<td align="center">1962</td>
</tr>
<tr class="even">
<td align="center">4</td>
<td align="center">1962-01-09</td>
<td align="center">02</td>
<td align="center">1962</td>
</tr>
<tr class="odd">
<td align="center">5</td>
<td align="center">1962-01-10</td>
<td align="center">02</td>
<td align="center">1962</td>
</tr>
<tr class="even">
<td align="center">6</td>
<td align="center">1962-01-11</td>
<td align="center">02</td>
<td align="center">1962</td>
</tr>
</tbody>
</table>
<table class="table">
<colgroup>
<col width="28%">
<col width="14%">
<col width="16%">
<col width="13%">
<col width="12%">
<col width="14%">
</colgroup>
<thead><tr class="header">
<th align="center">when_available_key</th>
<th align="center">when_key</th>
<th align="center">where_key</th>
<th align="center">who_key</th>
<th align="center">deaths</th>
<th align="center">nrow_agg</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">1</td>
<td align="center">1</td>
<td align="center">7</td>
<td align="center">2</td>
<td align="center">3</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">1</td>
<td align="center">1</td>
<td align="center">7</td>
<td align="center">3</td>
<td align="center">13</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">1</td>
<td align="center">1</td>
<td align="center">7</td>
<td align="center">4</td>
<td align="center">20</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">1</td>
<td align="center">1</td>
<td align="center">7</td>
<td align="center">5</td>
<td align="center">2</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">1</td>
<td align="center">1</td>
<td align="center">21</td>
<td align="center">1</td>
<td align="center">2</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">1</td>
<td align="center">1</td>
<td align="center">21</td>
<td align="center">2</td>
<td align="center">3</td>
<td align="center">1</td>
</tr>
</tbody>
</table>
<p>In the result, it can be seen that the dimensions related to date are
now role dimensions and do not have their own data, a role playing
dimension has been generated with the integrated data. The fact table
continues to refer to role dimensions, the value of foreign keys has
been adapted to the possible new values of the surrogate keys.
Additionally it can be seen that the <em>week</em> field now has length
2 and has 0 on the left (this is useful to sort numbers in text
format).</p>
</div>
<div class="section level4">
<h4 id="star-schema-definition-for-data-according-to-cause">Star schema definition for data according to cause<a class="anchor" aria-label="anchor" href="#star-schema-definition-for-data-according-to-cause"></a>
</h4>
<p>We are going to define the star schema and apply similar
transformations to the other flat table. The transformations can be
applied in any order.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">st_mrs_cause</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/star_schema.html">star_schema</a></span><span class="op">(</span><span class="va">mrs_cause</span>, <span class="va">dm_mrs_cause</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/snake_case.html">snake_case</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/character_dimensions.html">character_dimensions</a></span><span class="op">(</span></span>
<span>    NA_replacement_value <span class="op">=</span> <span class="st">"Unknown"</span>,</span>
<span>    length_integers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      week <span class="op">=</span> <span class="fl">2</span>,</span>
<span>      data_availability_week <span class="op">=</span> <span class="fl">2</span>,</span>
<span>      reception_week <span class="op">=</span> <span class="fl">2</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/role_playing_dimension.html">role_playing_dimension</a></span><span class="op">(</span></span>
<span>    dim_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"when"</span>, <span class="st">"when_received"</span>, <span class="st">"when_available"</span><span class="op">)</span>,</span>
<span>    name <span class="op">=</span> <span class="st">"when_common"</span>,</span>
<span>    attributes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"date"</span>, <span class="st">"week"</span>, <span class="st">"year"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>In this case, since the role playing dimension definition is the last
transformation defined, the format of the <em>week</em> column had to be
defined in the three date dimensions to obtain an equivalent result. The
result obtained is shown below.</p>
<table style="width:83%;" class="table">
<colgroup>
<col width="20%">
<col width="31%">
<col width="15%">
<col width="15%">
</colgroup>
<tbody><tr class="odd">
<td align="center"><strong>when_key</strong></td>
<td align="center"><strong>week_ending_date</strong></td>
<td align="center"><strong>week</strong></td>
<td align="center"><strong>year</strong></td>
</tr></tbody>
</table>
<table class="table">
<colgroup>
<col width="27%">
<col width="24%">
<col width="24%">
<col width="24%">
</colgroup>
<tbody><tr class="odd">
<td align="center"><strong>when_received_key</strong></td>
<td align="center"><strong>reception_date</strong></td>
<td align="center"><strong>reception_week</strong></td>
<td align="center"><strong>reception_year</strong></td>
</tr></tbody>
</table>
<table class="table">
<colgroup>
<col width="22%">
<col width="25%">
<col width="25%">
<col width="25%">
</colgroup>
<tbody><tr class="odd">
<td align="center"><strong>when_available_key</strong></td>
<td align="center"><strong>data_availability_date</strong></td>
<td align="center"><strong>data_availability_week</strong></td>
<td align="center"><strong>data_availability_year</strong></td>
</tr></tbody>
</table>
<table style="width:58%;" class="table">
<colgroup>
<col width="16%">
<col width="12%">
<col width="11%">
<col width="18%">
</colgroup>
<thead><tr class="header">
<th align="center">where_key</th>
<th align="center">region</th>
<th align="center">state</th>
<th align="center">city</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">1</td>
<td align="center">1</td>
<td align="center">CT</td>
<td align="center">Bridgepor</td>
</tr>
<tr class="even">
<td align="center">2</td>
<td align="center">1</td>
<td align="center">CT</td>
<td align="center">Bridgeport</td>
</tr>
<tr class="odd">
<td align="center">3</td>
<td align="center">1</td>
<td align="center">CT</td>
<td align="center">Hartford</td>
</tr>
<tr class="even">
<td align="center">4</td>
<td align="center">1</td>
<td align="center">CT</td>
<td align="center">New Haven</td>
</tr>
<tr class="odd">
<td align="center">5</td>
<td align="center">1</td>
<td align="center">CT</td>
<td align="center">Waterbury</td>
</tr>
<tr class="even">
<td align="center">6</td>
<td align="center">1</td>
<td align="center">MA</td>
<td align="center">Boston</td>
</tr>
</tbody>
</table>
<table style="width:62%;" class="table">
<colgroup>
<col width="25%">
<col width="18%">
<col width="9%">
<col width="9%">
</colgroup>
<thead><tr class="header">
<th align="center">when_common_key</th>
<th align="center">date</th>
<th align="center">week</th>
<th align="center">year</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">1</td>
<td align="center">1962-01-06</td>
<td align="center">01</td>
<td align="center">1962</td>
</tr>
<tr class="even">
<td align="center">2</td>
<td align="center">1962-01-07</td>
<td align="center">01</td>
<td align="center">1962</td>
</tr>
<tr class="odd">
<td align="center">3</td>
<td align="center">1962-01-08</td>
<td align="center">02</td>
<td align="center">1962</td>
</tr>
<tr class="even">
<td align="center">4</td>
<td align="center">1962-01-09</td>
<td align="center">02</td>
<td align="center">1962</td>
</tr>
<tr class="odd">
<td align="center">5</td>
<td align="center">1962-01-10</td>
<td align="center">02</td>
<td align="center">1962</td>
</tr>
<tr class="even">
<td align="center">6</td>
<td align="center">1962-01-11</td>
<td align="center">02</td>
<td align="center">1962</td>
</tr>
</tbody>
</table>
<table class="table">
<colgroup>
<col width="17%">
<col width="16%">
<col width="8%">
<col width="9%">
<col width="26%">
<col width="12%">
<col width="8%">
</colgroup>
<thead><tr class="header">
<th align="center">when_available_key</th>
<th align="center">when_received_key</th>
<th align="center">when_key</th>
<th align="center">where_key</th>
<th align="center">pneumonia_and_influenza_deaths</th>
<th align="center">other_deaths</th>
<th align="center">nrow_agg</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">1</td>
<td align="center">1</td>
<td align="center">1</td>
<td align="center">7</td>
<td align="center">1</td>
<td align="center">37</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">1</td>
<td align="center">1</td>
<td align="center">1</td>
<td align="center">21</td>
<td align="center">5</td>
<td align="center">32</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">1</td>
<td align="center">1</td>
<td align="center">1</td>
<td align="center">28</td>
<td align="center">2</td>
<td align="center">24</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">1</td>
<td align="center">1</td>
<td align="center">1</td>
<td align="center">50</td>
<td align="center">0</td>
<td align="center">35</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">1</td>
<td align="center">1</td>
<td align="center">1</td>
<td align="center">61</td>
<td align="center">12</td>
<td align="center">207</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">1</td>
<td align="center">1</td>
<td align="center">1</td>
<td align="center">66</td>
<td align="center">2</td>
<td align="center">81</td>
<td align="center">1</td>
</tr>
</tbody>
</table>
<p>In this case we have three role dimensions defined on a role playing
dimension.</p>
</div>
<div class="section level4">
<h4 id="star-schema-transformation-cleaning-and-conforming-data">Star schema transformation, cleaning and conforming data<a class="anchor" aria-label="anchor" href="#star-schema-transformation-cleaning-and-conforming-data"></a>
</h4>
<p>Star schemas are defined from flat table fields. In some cases it may
be interesting to rename elements of the schema, especially attributes
of dimensions and measures. On the other hand, dimensions can be
enriched by adding additional attributes, generally derived from the
rest of the attributes. These are the transformations considered in this
section.</p>
<p>We can perform data cleaning and conforming operations on star schema
dimensions. Updates defined in a star schema can be applied on another
with common dimensions.</p>
<div class="section level5">
<h5 id="star-schema-rename">Star schema rename<a class="anchor" aria-label="anchor" href="#star-schema-rename"></a>
</h5>
<p>If necessary, the elements of a star schema can be renamed. These
functions are especially useful for renaming attributes of dimensions
and measures of facts because the definition operations only allowed us
to select columns of a flat table, not modifying their names.</p>
<p>We are going to modify the attribute names of the <em>when</em>
dimension for the two design cases. The values of the attribute called
<em>region</em> actually correspond to the concept of <em>division</em>
in the organization of the US territory, we are going to rename it this
way for the two design cases.</p>
<p>Data according to age:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">st_mrs_age</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">st_mrs_age</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/rename_dimension_attributes.html">rename_dimension_attributes</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="st">"when"</span>,</span>
<span>    attributes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"week_ending_date"</span>, <span class="st">"week"</span>, <span class="st">"year"</span><span class="op">)</span>,</span>
<span>    new_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>      <span class="st">"when_happened_date"</span>,</span>
<span>      <span class="st">"when_happened_week"</span>,</span>
<span>      <span class="st">"when_happened_year"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/rename_dimension_attributes.html">rename_dimension_attributes</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="st">"where"</span>,</span>
<span>    attributes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"region"</span><span class="op">)</span>,</span>
<span>    new_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"division"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>And data according to cause:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">st_mrs_cause</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">st_mrs_cause</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/rename_dimension_attributes.html">rename_dimension_attributes</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="st">"when"</span>,</span>
<span>    attributes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"week_ending_date"</span>, <span class="st">"week"</span>, <span class="st">"year"</span><span class="op">)</span>,</span>
<span>    new_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>      <span class="st">"when_happened_date"</span>,</span>
<span>      <span class="st">"when_happened_week"</span>,</span>
<span>      <span class="st">"when_happened_year"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/rename_dimension_attributes.html">rename_dimension_attributes</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="st">"where"</span>,</span>
<span>    attributes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"region"</span><span class="op">)</span>,</span>
<span>    new_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"division"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>We are also going to modify the name of the measure for data
according to age:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">st_mrs_age</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">st_mrs_age</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/rename_measures.html">rename_measures</a></span><span class="op">(</span>measures <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"deaths"</span><span class="op">)</span>,</span>
<span>                                 new_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"n_deaths"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Additionally, functions are available to modify the names of
dimensions and facts. In this case it is not necessary to modify them
because they do not depend on the names of the starting base data and we
have defined them as we wanted.</p>
</div>
<div class="section level5">
<h5 id="definition-of-updates">Definition of updates<a class="anchor" aria-label="anchor" href="#definition-of-updates"></a>
</h5>
<p>Using the following code, first of all, we get the names of the
dimensions of a star schema, then, we get them by their name (we can see
the rows using the <code><a href="https://rdrr.io/r/utils/View.html" class="external-link">utils::View</a></code> function). If there are
several role dimensions, it is enough to consult one of them, updates
defined on it will be propagated to the rest.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dim_names</span> <span class="op">&lt;-</span> <span class="va">st_mrs_age</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/get_dimension_names.html">get_dimension_names</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">where</span> <span class="op">&lt;-</span> <span class="va">st_mrs_age</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/get_dimension.html">get_dimension</a></span><span class="op">(</span><span class="st">"where"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># View(where)</span></span>
<span><span class="co"># where[where$where_key %in% c(1, 2, 62), ]</span></span>
<span></span>
<span><span class="va">when</span> <span class="op">&lt;-</span> <span class="va">st_mrs_age</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/get_dimension.html">get_dimension</a></span><span class="op">(</span><span class="st">"when"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># View(when)</span></span>
<span><span class="co"># when[when$when_key %in% c(36, 37, 73), ]</span></span>
<span></span>
<span><span class="va">who</span> <span class="op">&lt;-</span> <span class="va">st_mrs_age</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/get_dimension.html">get_dimension</a></span><span class="op">(</span><span class="st">"who"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># View(who)</span></span></code></pre></div>
<p>Reviewing the dimensions we can detect the need for updates. Errors
are also sometimes detected by comparing the values with equivalent
values obtained from other data sources.</p>
<div class="section level6">
<h6 id="updates-in-the-where-dimension">Updates in the <em>where</em> dimension<a class="anchor" aria-label="anchor" href="#updates-in-the-where-dimension"></a>
</h6>
<p>In the <em>where</em> dimension we find the wrong value of
“Bridgepor”, generated by ourselves, the correct value is “Bridgeport”,
also included in the dimension. Additionally, trying to find additional
data associated with cities, we found another error for the city of
“Wilimington”, whose correct name is “Wilmington”. Below are the
mentioned instances.</p>
<table style="width:62%;" class="table">
<colgroup>
<col width="16%">
<col width="15%">
<col width="11%">
<col width="19%">
</colgroup>
<thead><tr class="header">
<th align="center">where_key</th>
<th align="center">division</th>
<th align="center">state</th>
<th align="center">city</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">1</td>
<td align="center">1</td>
<td align="center">CT</td>
<td align="center">Bridgepor</td>
</tr>
<tr class="even">
<td align="center">2</td>
<td align="center">1</td>
<td align="center">CT</td>
<td align="center">Bridgeport</td>
</tr>
<tr class="odd">
<td align="center">62</td>
<td align="center">5</td>
<td align="center">DE</td>
<td align="center">Wilimington</td>
</tr>
</tbody>
</table>
<p>Updates can be defined in several ways. One of them is referencing
the surrogate key. Although in some of the functions the dimension
surrogate key is referred to, updates only consider the values of the
rest of the columns of the corresponding dimension. In this way, it is
achieved that updates can be applied to equivalent dimensions of other
star schemas, where the values of the surrogate key do not necessarily
coincide with those of the dimension where updates were originally
defined.</p>
<p>Next, we define the update that indicates that the values of record
“1” (“Bridgepor”) of the <em>where</em> dimension must match those of
record “2” (“Bridgeport”).</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">updates_st_mrs_age</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/record_update_set.html">record_update_set</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/match_records.html">match_records</a></span><span class="op">(</span>dimension <span class="op">=</span> <span class="va">where</span>,</span>
<span>                old <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                new <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> </span></code></pre></div>
<p>For the case of the other city, we define an update that replaces the
value in the indicated fields for the records that meet the defined
condition, as shown below.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">updates_st_mrs_age</span> <span class="op">&lt;-</span> <span class="va">updates_st_mrs_age</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/update_selection_general.html">update_selection_general</a></span><span class="op">(</span></span>
<span>    dimension <span class="op">=</span> <span class="va">where</span>,</span>
<span>    columns_old <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"state"</span>, <span class="st">"city"</span><span class="op">)</span>,</span>
<span>    old_values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"DE"</span>, <span class="st">"Wilimington"</span><span class="op">)</span>,</span>
<span>    columns_new <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"city"</span><span class="op">)</span>,</span>
<span>    new_values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Wilmington"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> </span></code></pre></div>
</div>
<div class="section level6">
<h6 id="updates-in-the-when-dimension">Updates in the <em>when</em> dimension<a class="anchor" aria-label="anchor" href="#updates-in-the-when-dimension"></a>
</h6>
<p>Below is a selection of rows involved in update operations that are
referred by their surrogate key in the <em>when</em> dimension.</p>
<table class="table">
<colgroup>
<col width="14%">
<col width="28%">
<col width="28%">
<col width="28%">
</colgroup>
<thead><tr class="header">
<th align="center">when_key</th>
<th align="center">when_happened_date</th>
<th align="center">when_happened_week</th>
<th align="center">when_happened_year</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">36</td>
<td align="center">1962-02-10</td>
<td align="center">06</td>
<td align="center">1962</td>
</tr>
<tr class="even">
<td align="center">37</td>
<td align="center">1962-02-10</td>
<td align="center">Unknown</td>
<td align="center">Unknown</td>
</tr>
<tr class="odd">
<td align="center">73</td>
<td align="center">9999-12-31</td>
<td align="center">07</td>
<td align="center">1962</td>
</tr>
</tbody>
</table>
<p>The corresponding updates are shown below.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">updates_st_mrs_age</span> <span class="op">&lt;-</span> <span class="va">updates_st_mrs_age</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/match_records.html">match_records</a></span><span class="op">(</span>dimension <span class="op">=</span> <span class="va">when</span>,</span>
<span>                old <span class="op">=</span> <span class="fl">37</span>,</span>
<span>                new <span class="op">=</span> <span class="fl">36</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/update_record.html">update_record</a></span><span class="op">(</span></span>
<span>    dimension <span class="op">=</span> <span class="va">when</span>,</span>
<span>    old <span class="op">=</span> <span class="fl">73</span>,</span>
<span>    values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1962-02-17"</span>, <span class="st">"07"</span>, <span class="st">"1962"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>The values of record “37” must match those of record “36” (both
registers will be unified). The values in register “73” will be replaced
by those provided.</p>
</div>
<div class="section level6">
<h6 id="updates-in-the-who-dimension">Updates in the <em>who</em> dimension<a class="anchor" aria-label="anchor" href="#updates-in-the-who-dimension"></a>
</h6>
<p>In the case of the <em>who</em> dimension, we want to include a code
in each value of <code>age_range</code> attribute so that they are
sorted increasingly based on their value.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">updates_st_mrs_age</span> <span class="op">&lt;-</span> <span class="va">updates_st_mrs_age</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/update_selection.html">update_selection</a></span><span class="op">(</span></span>
<span>    dimension <span class="op">=</span> <span class="va">who</span>,</span>
<span>    columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age_range"</span><span class="op">)</span>,</span>
<span>    old_values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"&lt;1 year"</span><span class="op">)</span>,</span>
<span>    new_values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1: &lt;1 year"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/update_selection.html">update_selection</a></span><span class="op">(</span></span>
<span>    dimension <span class="op">=</span> <span class="va">who</span>,</span>
<span>    columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age_range"</span><span class="op">)</span>,</span>
<span>    old_values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1-24 years"</span><span class="op">)</span>,</span>
<span>    new_values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2: 1-24 years"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/update_selection.html">update_selection</a></span><span class="op">(</span></span>
<span>    dimension <span class="op">=</span> <span class="va">who</span>,</span>
<span>    columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age_range"</span><span class="op">)</span>,</span>
<span>    old_values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"25-44 years"</span><span class="op">)</span>,</span>
<span>    new_values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"3: 25-44 years"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/update_selection.html">update_selection</a></span><span class="op">(</span></span>
<span>    dimension <span class="op">=</span> <span class="va">who</span>,</span>
<span>    columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age_range"</span><span class="op">)</span>,</span>
<span>    old_values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"45-64 years"</span><span class="op">)</span>,</span>
<span>    new_values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"4: 45-64 years"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/update_selection.html">update_selection</a></span><span class="op">(</span></span>
<span>    dimension <span class="op">=</span> <span class="va">who</span>,</span>
<span>    columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age_range"</span><span class="op">)</span>,</span>
<span>    old_values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"65+ years"</span><span class="op">)</span>,</span>
<span>    new_values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"5: 65+ years"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>In each case, we substitute the old value for the new one in the
indicated attribute.</p>
</div>
</div>
<div class="section level5">
<h5 id="updates-application">Updates application<a class="anchor" aria-label="anchor" href="#updates-application"></a>
</h5>
<p>Once updates are defined, they can be applied on the star schema from
which they have been defined, as shown below.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">st_mrs_age</span> <span class="op">&lt;-</span> <span class="va">st_mrs_age</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/modify_dimension_records.html">modify_dimension_records</a></span><span class="op">(</span><span class="va">updates_st_mrs_age</span><span class="op">)</span></span></code></pre></div>
<p>The result obtained for the first star schema is shown below.</p>
<table class="table">
<colgroup>
<col width="16%">
<col width="27%">
<col width="27%">
<col width="27%">
</colgroup>
<tbody><tr class="odd">
<td align="center"><strong>when_key</strong></td>
<td align="center"><strong>when_happened_date</strong></td>
<td align="center"><strong>when_happened_week</strong></td>
<td align="center"><strong>when_happened_year</strong></td>
</tr></tbody>
</table>
<table class="table">
<colgroup>
<col width="22%">
<col width="25%">
<col width="25%">
<col width="25%">
</colgroup>
<tbody><tr class="odd">
<td align="center"><strong>when_available_key</strong></td>
<td align="center"><strong>data_availability_date</strong></td>
<td align="center"><strong>data_availability_week</strong></td>
<td align="center"><strong>data_availability_year</strong></td>
</tr></tbody>
</table>
<table style="width:61%;" class="table">
<colgroup>
<col width="16%">
<col width="15%">
<col width="11%">
<col width="18%">
</colgroup>
<thead><tr class="header">
<th align="center">where_key</th>
<th align="center">division</th>
<th align="center">state</th>
<th align="center">city</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">1</td>
<td align="center">1</td>
<td align="center">CT</td>
<td align="center">Bridgeport</td>
</tr>
<tr class="even">
<td align="center">2</td>
<td align="center">1</td>
<td align="center">CT</td>
<td align="center">Hartford</td>
</tr>
<tr class="odd">
<td align="center">3</td>
<td align="center">1</td>
<td align="center">CT</td>
<td align="center">New Haven</td>
</tr>
<tr class="even">
<td align="center">4</td>
<td align="center">1</td>
<td align="center">CT</td>
<td align="center">Waterbury</td>
</tr>
<tr class="odd">
<td align="center">5</td>
<td align="center">1</td>
<td align="center">MA</td>
<td align="center">Boston</td>
</tr>
<tr class="even">
<td align="center">6</td>
<td align="center">1</td>
<td align="center">MA</td>
<td align="center">Cambridge</td>
</tr>
</tbody>
</table>
<table style="width:38%;" class="table">
<colgroup>
<col width="13%">
<col width="23%">
</colgroup>
<thead><tr class="header">
<th align="center">who_key</th>
<th align="center">age_range</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">1</td>
<td align="center">1: &lt;1 year</td>
</tr>
<tr class="even">
<td align="center">2</td>
<td align="center">2: 1-24 years</td>
</tr>
<tr class="odd">
<td align="center">3</td>
<td align="center">3: 25-44 years</td>
</tr>
<tr class="even">
<td align="center">4</td>
<td align="center">4: 45-64 years</td>
</tr>
<tr class="odd">
<td align="center">5</td>
<td align="center">5: 65+ years</td>
</tr>
</tbody>
</table>
<table style="width:62%;" class="table">
<colgroup>
<col width="25%">
<col width="18%">
<col width="9%">
<col width="9%">
</colgroup>
<thead><tr class="header">
<th align="center">when_common_key</th>
<th align="center">date</th>
<th align="center">week</th>
<th align="center">year</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">1</td>
<td align="center">1962-01-06</td>
<td align="center">01</td>
<td align="center">1962</td>
</tr>
<tr class="even">
<td align="center">2</td>
<td align="center">1962-01-07</td>
<td align="center">01</td>
<td align="center">1962</td>
</tr>
<tr class="odd">
<td align="center">3</td>
<td align="center">1962-01-08</td>
<td align="center">02</td>
<td align="center">1962</td>
</tr>
<tr class="even">
<td align="center">4</td>
<td align="center">1962-01-09</td>
<td align="center">02</td>
<td align="center">1962</td>
</tr>
<tr class="odd">
<td align="center">5</td>
<td align="center">1962-01-10</td>
<td align="center">02</td>
<td align="center">1962</td>
</tr>
<tr class="even">
<td align="center">6</td>
<td align="center">1962-01-11</td>
<td align="center">02</td>
<td align="center">1962</td>
</tr>
</tbody>
</table>
<table class="table">
<colgroup>
<col width="13%">
<col width="15%">
<col width="27%">
<col width="14%">
<col width="14%">
<col width="14%">
</colgroup>
<thead><tr class="header">
<th align="center">who_key</th>
<th align="center">where_key</th>
<th align="center">when_available_key</th>
<th align="center">when_key</th>
<th align="center">n_deaths</th>
<th align="center">nrow_agg</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">1</td>
<td align="center">1</td>
<td align="center">10</td>
<td align="center">1</td>
<td align="center">3</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">1</td>
<td align="center">1</td>
<td align="center">12</td>
<td align="center">8</td>
<td align="center">1</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">1</td>
<td align="center">1</td>
<td align="center">18</td>
<td align="center">15</td>
<td align="center">5</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">1</td>
<td align="center">1</td>
<td align="center">23</td>
<td align="center">22</td>
<td align="center">3</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">1</td>
<td align="center">1</td>
<td align="center">31</td>
<td align="center">29</td>
<td align="center">6</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">1</td>
<td align="center">1</td>
<td align="center">49</td>
<td align="center">36</td>
<td align="center">3</td>
<td align="center">1</td>
</tr>
</tbody>
</table>
<p>It can be seen that the row with the value “Bridgepor” in the
<em>city</em> column has disappeared: it has been merged with the row
with the correct value. This update has also been transmitted to the
fact table. Although it is not seen in the tables, the same has happened
with the dates that have been unified by the update.</p>
<p>The same updates can also be applied to other star schemas with
dimensions in common with the original star schema, as shown below.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">st_mrs_cause</span> <span class="op">&lt;-</span> <span class="va">st_mrs_cause</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/modify_dimension_records.html">modify_dimension_records</a></span><span class="op">(</span><span class="va">updates_st_mrs_age</span><span class="op">)</span></span></code></pre></div>
<p>Updates defined on dimensions not included in the star schema are
ignored. In this case those referring to the who dimension. Likewise, if
there are no records that meet the conditions to get the old value, they
are also ignored.</p>
</div>
<div class="section level5">
<h5 id="dimension-enrichment-1">Dimension enrichment<a class="anchor" aria-label="anchor" href="#dimension-enrichment-1"></a>
</h5>
<p>From the original attributes included in the dimensions, we can
obtain new attributes that facilitate queries or offer new query
possibilities.</p>
<div class="section level6">
<h6 id="enrich-the-who-dimension">Enrich the <em>who</em> dimension<a class="anchor" aria-label="anchor" href="#enrich-the-who-dimension"></a>
</h6>
<p>Suppose that we are interested in defining some broader age ranges
than the existing ones. This operation can be done by enriching the
corresponding dimension.</p>
<p>First, we export the attributes to consider in table form, in this
case only the age range.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tb_who</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/enrich_dimension_export.html">enrich_dimension_export</a></span><span class="op">(</span><span class="va">st_mrs_age</span>,</span>
<span>                          name <span class="op">=</span> <span class="st">"who"</span>,</span>
<span>                          attributes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age_range"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Next, we can see the result of the export operation. It is a table
with the selected attributes where duplicate values have been eliminated
if there are any (in this case there are no repeated values).</p>
<table style="width:24%;" class="table">
<colgroup><col width="23%"></colgroup>
<thead><tr class="header">
<th align="center">age_range</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">1: &lt;1 year</td>
</tr>
<tr class="even">
<td align="center">2: 1-24 years</td>
</tr>
<tr class="odd">
<td align="center">3: 25-44 years</td>
</tr>
<tr class="even">
<td align="center">4: 45-64 years</td>
</tr>
<tr class="odd">
<td align="center">5: 65+ years</td>
</tr>
</tbody>
</table>
<p>In the table we add the columns that we want. In this case a new
column to define the new broader age range.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">v</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"0-24 years"</span>, <span class="st">"0-24 years"</span>, <span class="st">"25+ years"</span>, <span class="st">"25+ years"</span>, <span class="st">"25+ years"</span><span class="op">)</span></span>
<span><span class="va">tb_who</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/add_column.html" class="external-link">add_column</a></span><span class="op">(</span><span class="va">tb_who</span>,</span>
<span>                     wide_age_range <span class="op">=</span> <span class="va">v</span><span class="op">)</span></span></code></pre></div>
<p>The new table can be seen below.</p>
<table style="width:47%;" class="table">
<colgroup>
<col width="23%">
<col width="23%">
</colgroup>
<thead><tr class="header">
<th align="center">age_range</th>
<th align="center">wide_age_range</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">1: &lt;1 year</td>
<td align="center">0-24 years</td>
</tr>
<tr class="even">
<td align="center">2: 1-24 years</td>
<td align="center">0-24 years</td>
</tr>
<tr class="odd">
<td align="center">3: 25-44 years</td>
<td align="center">25+ years</td>
</tr>
<tr class="even">
<td align="center">4: 45-64 years</td>
<td align="center">25+ years</td>
</tr>
<tr class="odd">
<td align="center">5: 65+ years</td>
<td align="center">25+ years</td>
</tr>
</tbody>
</table>
<p>We enrich the dimension considering the new data in the table.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">st_mrs_age</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">st_mrs_age</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/enrich_dimension_import.html">enrich_dimension_import</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"who"</span>, <span class="va">tb_who</span><span class="op">)</span></span></code></pre></div>
<p>We can see the result below, where the dimension has the new defined
attribute.</p>
<table style="width:61%;" class="table">
<colgroup>
<col width="13%">
<col width="23%">
<col width="23%">
</colgroup>
<thead><tr class="header">
<th align="center">who_key</th>
<th align="center">age_range</th>
<th align="center">wide_age_range</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">1</td>
<td align="center">1: &lt;1 year</td>
<td align="center">0-24 years</td>
</tr>
<tr class="even">
<td align="center">2</td>
<td align="center">2: 1-24 years</td>
<td align="center">0-24 years</td>
</tr>
<tr class="odd">
<td align="center">3</td>
<td align="center">3: 25-44 years</td>
<td align="center">25+ years</td>
</tr>
<tr class="even">
<td align="center">4</td>
<td align="center">4: 45-64 years</td>
<td align="center">25+ years</td>
</tr>
<tr class="odd">
<td align="center">5</td>
<td align="center">5: 65+ years</td>
<td align="center">25+ years</td>
</tr>
</tbody>
</table>
</div>
<div class="section level6">
<h6 id="enrich-the-where-dimension">Enrich the <em>where</em> dimension<a class="anchor" aria-label="anchor" href="#enrich-the-where-dimension"></a>
</h6>
<p>For the <em>where</em> dimension we can proceed in the same way as we
have done for the <em>who</em> dimension: Export the data, complete it
manually and import it again, as shown below.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tb_where</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/enrich_dimension_export.html">enrich_dimension_export</a></span><span class="op">(</span><span class="va">st_mrs_age</span>,</span>
<span>                          name <span class="op">=</span> <span class="st">"where"</span>,</span>
<span>                          attributes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"division"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The new table for <em>division</em> data can be seen below.</p>
<table style="width:15%;" class="table">
<colgroup><col width="15%"></colgroup>
<thead><tr class="header">
<th align="center">division</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">2</td>
</tr>
<tr class="odd">
<td align="center">3</td>
</tr>
<tr class="even">
<td align="center">4</td>
</tr>
<tr class="odd">
<td align="center">5</td>
</tr>
<tr class="even">
<td align="center">6</td>
</tr>
<tr class="odd">
<td align="center">7</td>
</tr>
<tr class="even">
<td align="center">8</td>
</tr>
<tr class="odd">
<td align="center">9</td>
</tr>
</tbody>
</table>
<p>We look for the names of the divisions and add the data of the
regions to which they belong.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tb_where</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/add_column.html" class="external-link">add_column</a></span><span class="op">(</span></span>
<span>    <span class="va">tb_where</span>,</span>
<span>    division_name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>      <span class="st">"New England"</span>,</span>
<span>      <span class="st">"Middle Atlantic"</span>,</span>
<span>      <span class="st">"East North Central"</span>,</span>
<span>      <span class="st">"West North Central"</span>,</span>
<span>      <span class="st">"South Atlantic"</span>,</span>
<span>      <span class="st">"East South Central"</span>,</span>
<span>      <span class="st">"West South Central"</span>,</span>
<span>      <span class="st">"Mountain"</span>,</span>
<span>      <span class="st">"Pacific"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    region <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'1'</span>,</span>
<span>               <span class="st">'1'</span>,</span>
<span>               <span class="st">'2'</span>,</span>
<span>               <span class="st">'2'</span>,</span>
<span>               <span class="st">'3'</span>,</span>
<span>               <span class="st">'3'</span>,</span>
<span>               <span class="st">'3'</span>,</span>
<span>               <span class="st">'4'</span>,</span>
<span>               <span class="st">'4'</span><span class="op">)</span>,</span>
<span>    region_name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>      <span class="st">"Northeast"</span>,</span>
<span>      <span class="st">"Northeast"</span>,</span>
<span>      <span class="st">"Midwest"</span>,</span>
<span>      <span class="st">"Midwest"</span>,</span>
<span>      <span class="st">"South"</span>,</span>
<span>      <span class="st">"South"</span>,</span>
<span>      <span class="st">"South"</span>,</span>
<span>      <span class="st">"West"</span>,</span>
<span>      <span class="st">"West"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">st_mrs_age</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">st_mrs_age</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/enrich_dimension_import.html">enrich_dimension_import</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"where"</span>, <span class="va">tb_where</span><span class="op">)</span></span>
<span></span>
<span><span class="va">st_mrs_cause</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">st_mrs_cause</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/enrich_dimension_import.html">enrich_dimension_import</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"where"</span>, <span class="va">tb_where</span><span class="op">)</span></span></code></pre></div>
<p>To add the name of the states and the county to which each city
belongs, we could proceed in the same way. However, it is easier if we
try to locate this data and use it directly. These data are available in
the <code>ft_usa_states</code> and <code>ft_usa_city_county</code> data
sets, respectively.</p>
<p>However, if we operate in the same way, when importing the data an
error occurs. The reason is that not all the data in the dimension
matches the data in the imported table. We can determine the missing
data using the following function.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tb_missing</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">st_mrs_age</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/enrich_dimension_import_test.html">enrich_dimension_import_test</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"where"</span>, <span class="va">ft_usa_states</span><span class="op">)</span></span></code></pre></div>
<p>The result obtained is shown below.</p>
<table class="table">
<colgroup>
<col width="13%">
<col width="12%">
<col width="11%">
<col width="11%">
<col width="24%">
<col width="10%">
<col width="16%">
</colgroup>
<thead><tr class="header">
<th align="center">where_key</th>
<th align="center">division</th>
<th align="center">state</th>
<th align="center">city</th>
<th align="center">division_name</th>
<th align="center">region</th>
<th align="center">region_name</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">48</td>
<td align="center">3</td>
<td align="center">Unknown</td>
<td align="center">Unknown</td>
<td align="center">East North Central</td>
<td align="center">2</td>
<td align="center">Midwest</td>
</tr>
<tr class="even">
<td align="center">78</td>
<td align="center">6</td>
<td align="center">Unknown</td>
<td align="center">Unknown</td>
<td align="center">East South Central</td>
<td align="center">3</td>
<td align="center">South</td>
</tr>
<tr class="odd">
<td align="center">91</td>
<td align="center">7</td>
<td align="center">Unknown</td>
<td align="center">Unknown</td>
<td align="center">West South Central</td>
<td align="center">3</td>
<td align="center">South</td>
</tr>
<tr class="even">
<td align="center">111</td>
<td align="center">9</td>
<td align="center">Unknown</td>
<td align="center">Unknown</td>
<td align="center">Pacific</td>
<td align="center">4</td>
<td align="center">West</td>
</tr>
</tbody>
</table>
<p>In all cases, the problem occurs for the value “Unknown” in the
<em>state</em> attribute. We must add a row to the data before importing
it.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tb_where_state</span> <span class="op">&lt;-</span> <span class="va">ft_usa_states</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/add_row.html" class="external-link">add_row</a></span><span class="op">(</span>state <span class="op">=</span> <span class="st">"Unknown"</span>, state_name <span class="op">=</span> <span class="st">"Unknown"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">st_mrs_age</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">st_mrs_age</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/enrich_dimension_import.html">enrich_dimension_import</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"where"</span>, <span class="va">tb_where_state</span><span class="op">)</span></span>
<span></span>
<span><span class="va">st_mrs_cause</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">st_mrs_cause</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/enrich_dimension_import.html">enrich_dimension_import</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"where"</span>, <span class="va">tb_where_state</span><span class="op">)</span></span></code></pre></div>
<p>The same problem occurs and we apply the same solution to add the
county data<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;This is how I have located the problem with the value
“Wilimington” in the &lt;em&gt;city&lt;/em&gt; attribute, which we have already
corrected, so it no longer appears.&lt;/p&gt;"><sup>4</sup></a>.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tb_where_county</span> <span class="op">&lt;-</span> <span class="va">ft_usa_city_county</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/add_row.html" class="external-link">add_row</a></span><span class="op">(</span>city <span class="op">=</span> <span class="st">"Unknown"</span>,</span>
<span>                  state <span class="op">=</span> <span class="st">"Unknown"</span>,</span>
<span>                  county <span class="op">=</span> <span class="st">"Unknown"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">st_mrs_age</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">st_mrs_age</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/enrich_dimension_import.html">enrich_dimension_import</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"where"</span>, <span class="va">tb_where_county</span><span class="op">)</span></span>
<span></span>
<span><span class="va">st_mrs_cause</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">st_mrs_cause</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/enrich_dimension_import.html">enrich_dimension_import</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"where"</span>, <span class="va">tb_where_county</span><span class="op">)</span></span></code></pre></div>
<p>We can see the first rows of the final result below.</p>
<table style="width:100%;" class="table">
<colgroup>
<col width="10%">
<col width="9%">
<col width="7%">
<col width="12%">
<col width="14%">
<col width="8%">
<col width="12%">
<col width="14%">
<col width="10%">
</colgroup>
<thead><tr class="header">
<th align="center">where_key</th>
<th align="center">division</th>
<th align="center">state</th>
<th align="center">city</th>
<th align="center">division_name</th>
<th align="center">region</th>
<th align="center">region_name</th>
<th align="center">state_name</th>
<th align="center">county</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">1</td>
<td align="center">1</td>
<td align="center">CT</td>
<td align="center">Bridgeport</td>
<td align="center">New England</td>
<td align="center">1</td>
<td align="center">Northeast</td>
<td align="center">Connecticut</td>
<td align="center">Fairfield</td>
</tr>
<tr class="even">
<td align="center">2</td>
<td align="center">1</td>
<td align="center">CT</td>
<td align="center">Hartford</td>
<td align="center">New England</td>
<td align="center">1</td>
<td align="center">Northeast</td>
<td align="center">Connecticut</td>
<td align="center">Hartford</td>
</tr>
<tr class="odd">
<td align="center">3</td>
<td align="center">1</td>
<td align="center">CT</td>
<td align="center">New Haven</td>
<td align="center">New England</td>
<td align="center">1</td>
<td align="center">Northeast</td>
<td align="center">Connecticut</td>
<td align="center">New Haven</td>
</tr>
<tr class="even">
<td align="center">4</td>
<td align="center">1</td>
<td align="center">CT</td>
<td align="center">Waterbury</td>
<td align="center">New England</td>
<td align="center">1</td>
<td align="center">Northeast</td>
<td align="center">Connecticut</td>
<td align="center">New Haven</td>
</tr>
<tr class="odd">
<td align="center">5</td>
<td align="center">1</td>
<td align="center">MA</td>
<td align="center">Boston</td>
<td align="center">New England</td>
<td align="center">1</td>
<td align="center">Northeast</td>
<td align="center">Massachusetts</td>
<td align="center">Suffolk</td>
</tr>
<tr class="even">
<td align="center">6</td>
<td align="center">1</td>
<td align="center">MA</td>
<td align="center">Cambridge</td>
<td align="center">New England</td>
<td align="center">1</td>
<td align="center">Northeast</td>
<td align="center">Massachusetts</td>
<td align="center">Middlesex</td>
</tr>
<tr class="odd">
<td align="center">7</td>
<td align="center">1</td>
<td align="center">MA</td>
<td align="center">Fall River</td>
<td align="center">New England</td>
<td align="center">1</td>
<td align="center">Northeast</td>
<td align="center">Massachusetts</td>
<td align="center">Bristol</td>
</tr>
<tr class="even">
<td align="center">8</td>
<td align="center">1</td>
<td align="center">MA</td>
<td align="center">Lowell</td>
<td align="center">New England</td>
<td align="center">1</td>
<td align="center">Northeast</td>
<td align="center">Massachusetts</td>
<td align="center">Middlesex</td>
</tr>
<tr class="odd">
<td align="center">9</td>
<td align="center">1</td>
<td align="center">MA</td>
<td align="center">Lynn</td>
<td align="center">New England</td>
<td align="center">1</td>
<td align="center">Northeast</td>
<td align="center">Massachusetts</td>
<td align="center">Essex</td>
</tr>
<tr class="even">
<td align="center">10</td>
<td align="center">1</td>
<td align="center">MA</td>
<td align="center">New Bedford</td>
<td align="center">New England</td>
<td align="center">1</td>
<td align="center">Northeast</td>
<td align="center">Massachusetts</td>
<td align="center">Bristol</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="section level4">
<h4 id="constellation-definition">Constellation definition<a class="anchor" aria-label="anchor" href="#constellation-definition"></a>
</h4>
<p>A constellation is defined from a list of star schemas, as shown
below.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ct_mrs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/constellation.html">constellation</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">st_mrs_age</span>, <span class="va">st_mrs_cause</span><span class="op">)</span>, name <span class="op">=</span> <span class="st">"mrs"</span><span class="op">)</span></span></code></pre></div>
<p>All dimensions of the same name in star schemas must be compatible in
structure and type of columns, and are defined as conformed dimensions.
The conformed dimensions share all the instances of the original
dimensions, this implies possible modifications in the surrogate keys
that are transmitted to foreign keys of the component fact tables.</p>
<p>The tables of the obtained conformed dimensions are shown below.</p>
<table class="table">
<colgroup>
<col width="14%">
<col width="28%">
<col width="28%">
<col width="28%">
</colgroup>
<thead><tr class="header">
<th align="center">when_key</th>
<th align="center">when_happened_date</th>
<th align="center">when_happened_week</th>
<th align="center">when_happened_year</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">1</td>
<td align="center">1962-01-06</td>
<td align="center">01</td>
<td align="center">1962</td>
</tr>
<tr class="even">
<td align="center">2</td>
<td align="center">1962-01-07</td>
<td align="center">01</td>
<td align="center">1962</td>
</tr>
<tr class="odd">
<td align="center">3</td>
<td align="center">1962-01-08</td>
<td align="center">02</td>
<td align="center">1962</td>
</tr>
<tr class="even">
<td align="center">4</td>
<td align="center">1962-01-09</td>
<td align="center">02</td>
<td align="center">1962</td>
</tr>
<tr class="odd">
<td align="center">5</td>
<td align="center">1962-01-10</td>
<td align="center">02</td>
<td align="center">1962</td>
</tr>
<tr class="even">
<td align="center">6</td>
<td align="center">1962-01-11</td>
<td align="center">02</td>
<td align="center">1962</td>
</tr>
</tbody>
</table>
<table class="table">
<colgroup>
<col width="21%">
<col width="26%">
<col width="26%">
<col width="26%">
</colgroup>
<thead><tr class="header">
<th align="center">when_available_key</th>
<th align="center">data_availability_date</th>
<th align="center">data_availability_week</th>
<th align="center">data_availability_year</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">1</td>
<td align="center">1962-01-06</td>
<td align="center">01</td>
<td align="center">1962</td>
</tr>
<tr class="even">
<td align="center">2</td>
<td align="center">1962-01-07</td>
<td align="center">01</td>
<td align="center">1962</td>
</tr>
<tr class="odd">
<td align="center">3</td>
<td align="center">1962-01-08</td>
<td align="center">02</td>
<td align="center">1962</td>
</tr>
<tr class="even">
<td align="center">4</td>
<td align="center">1962-01-09</td>
<td align="center">02</td>
<td align="center">1962</td>
</tr>
<tr class="odd">
<td align="center">5</td>
<td align="center">1962-01-10</td>
<td align="center">02</td>
<td align="center">1962</td>
</tr>
<tr class="even">
<td align="center">6</td>
<td align="center">1962-01-11</td>
<td align="center">02</td>
<td align="center">1962</td>
</tr>
</tbody>
</table>
<table style="width:100%;" class="table">
<colgroup>
<col width="10%">
<col width="9%">
<col width="7%">
<col width="11%">
<col width="14%">
<col width="8%">
<col width="12%">
<col width="14%">
<col width="10%">
</colgroup>
<thead><tr class="header">
<th align="center">where_key</th>
<th align="center">division</th>
<th align="center">state</th>
<th align="center">city</th>
<th align="center">division_name</th>
<th align="center">region</th>
<th align="center">region_name</th>
<th align="center">state_name</th>
<th align="center">county</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">1</td>
<td align="center">1</td>
<td align="center">CT</td>
<td align="center">Bridgeport</td>
<td align="center">New England</td>
<td align="center">1</td>
<td align="center">Northeast</td>
<td align="center">Connecticut</td>
<td align="center">Fairfield</td>
</tr>
<tr class="even">
<td align="center">2</td>
<td align="center">1</td>
<td align="center">CT</td>
<td align="center">Hartford</td>
<td align="center">New England</td>
<td align="center">1</td>
<td align="center">Northeast</td>
<td align="center">Connecticut</td>
<td align="center">Hartford</td>
</tr>
<tr class="odd">
<td align="center">3</td>
<td align="center">1</td>
<td align="center">CT</td>
<td align="center">New Haven</td>
<td align="center">New England</td>
<td align="center">1</td>
<td align="center">Northeast</td>
<td align="center">Connecticut</td>
<td align="center">New Haven</td>
</tr>
<tr class="even">
<td align="center">4</td>
<td align="center">1</td>
<td align="center">CT</td>
<td align="center">Waterbury</td>
<td align="center">New England</td>
<td align="center">1</td>
<td align="center">Northeast</td>
<td align="center">Connecticut</td>
<td align="center">New Haven</td>
</tr>
<tr class="odd">
<td align="center">5</td>
<td align="center">1</td>
<td align="center">MA</td>
<td align="center">Boston</td>
<td align="center">New England</td>
<td align="center">1</td>
<td align="center">Northeast</td>
<td align="center">Massachusetts</td>
<td align="center">Suffolk</td>
</tr>
<tr class="even">
<td align="center">6</td>
<td align="center">1</td>
<td align="center">MA</td>
<td align="center">Cambridge</td>
<td align="center">New England</td>
<td align="center">1</td>
<td align="center">Northeast</td>
<td align="center">Massachusetts</td>
<td align="center">Middlesex</td>
</tr>
</tbody>
</table>
<p>It can be seen that the conformed dimensions are considered
regardless of the type of dimension in the star schema. Definition of
conformed dimensions does not imply any change in the definition of
dimensions in star schemas: Role and role playing dimensions remain the
same, only their rows may have changed.</p>
<p>In this particular case there are no discrepancies in the values of
the star schemas dimension instances, since the data source is the same
for both.</p>
<p>If discrepancies are detected once the integration has been carried
out, new modification operations can be defined on conformed dimensions
(as it has been done for the dimensions of star schemas) that are
applied at the constellation level and are automatically transmitted to
the component star schemas
(<code>modify_conformed_dimension_records</code>).</p>
</div>
</div>
<div class="section level3">
<h3 id="incremental-refresh-1">Incremental refresh<a class="anchor" aria-label="anchor" href="#incremental-refresh-1"></a>
</h3>
<p>Once we have star schemas built with the data available at the
moment, we may obtain additional data, with the same structure as the
initial data but from a later time. Sometimes the new data also includes
data from previous periods to operate on them.</p>
<p>Under these conditions, suppose we get the data sets
<code>mrs_age_w10</code>, <code>mrs_age_w11</code>,
<code>mrs_cause_w10</code>, and <code>mrs_cause_w11</code>, for weeks 10
and 11 (data in star schemas runs through week 9). In all cases, some
data from previous periods are included.</p>
<p>To perform an incremental refresh of a star schema, we must have the
new data in the same star schema format. Additionally, if we have done
data cleaning, it is likely that we will have to correct part of the
corrected errors again over the new data. For this reason, it is best to
package all the transformations carried out on the original data in
function form so that they can be easily applied to new data.</p>
<div class="section level4">
<h4 id="refresh-operations-for-data-according-to-age-range">Refresh operations for data according to age range<a class="anchor" aria-label="anchor" href="#refresh-operations-for-data-according-to-age-range"></a>
</h4>
<p>Below you can see the function that groups the transformations
defined for the data according to the age range.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mrs_age_definition</span> <span class="op">&lt;-</span></span>
<span>  <span class="kw">function</span><span class="op">(</span><span class="va">ft</span>,</span>
<span>           <span class="va">dm</span>,</span>
<span>           <span class="va">updates</span>,</span>
<span>           <span class="va">tb_who</span>,</span>
<span>           <span class="va">tb_where</span>,</span>
<span>           <span class="va">tb_where_state</span>,</span>
<span>           <span class="va">tb_where_county</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="../reference/star_schema.html">star_schema</a></span><span class="op">(</span><span class="va">ft</span>, <span class="va">dm</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="../reference/role_playing_dimension.html">role_playing_dimension</a></span><span class="op">(</span></span>
<span>        dim_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"when"</span>, <span class="st">"when_available"</span><span class="op">)</span>,</span>
<span>        name <span class="op">=</span> <span class="st">"When Common"</span>,</span>
<span>        attributes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"date"</span>, <span class="st">"week"</span>, <span class="st">"year"</span><span class="op">)</span></span>
<span>      <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="../reference/snake_case.html">snake_case</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="../reference/character_dimensions.html">character_dimensions</a></span><span class="op">(</span>NA_replacement_value <span class="op">=</span> <span class="st">"Unknown"</span>,</span>
<span>                           length_integers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>week <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="../reference/rename_dimension_attributes.html">rename_dimension_attributes</a></span><span class="op">(</span></span>
<span>        name <span class="op">=</span> <span class="st">"when"</span>,</span>
<span>        attributes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"week_ending_date"</span>, <span class="st">"week"</span>, <span class="st">"year"</span><span class="op">)</span>,</span>
<span>        new_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>          <span class="st">"when_happened_date"</span>,</span>
<span>          <span class="st">"when_happened_week"</span>,</span>
<span>          <span class="st">"when_happened_year"</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="../reference/rename_dimension_attributes.html">rename_dimension_attributes</a></span><span class="op">(</span></span>
<span>        name <span class="op">=</span> <span class="st">"where"</span>,</span>
<span>        attributes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"region"</span><span class="op">)</span>,</span>
<span>        new_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"division"</span><span class="op">)</span></span>
<span>      <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="../reference/rename_measures.html">rename_measures</a></span><span class="op">(</span>measures <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"deaths"</span><span class="op">)</span>,</span>
<span>                      new_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"n_deaths"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="../reference/modify_dimension_records.html">modify_dimension_records</a></span><span class="op">(</span><span class="va">updates</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="../reference/enrich_dimension_import.html">enrich_dimension_import</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"who"</span>, <span class="va">tb_who</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="../reference/enrich_dimension_import.html">enrich_dimension_import</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"where"</span>, <span class="va">tb_where</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="../reference/enrich_dimension_import.html">enrich_dimension_import</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"where"</span>, <span class="va">tb_where_state</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="../reference/enrich_dimension_import.html">enrich_dimension_import</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"where"</span>, <span class="va">tb_where_county</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span></code></pre></div>
<p>We apply this function to new data sets, as shown below.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">st_mrs_age_w10</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">mrs_age_definition</span><span class="op">(</span></span>
<span>    <span class="va">mrs_age_w10</span>,</span>
<span>    <span class="va">dm_mrs_age</span>,</span>
<span>    <span class="va">updates_st_mrs_age</span>,</span>
<span>    <span class="va">tb_who</span>,</span>
<span>    <span class="va">tb_where</span>,</span>
<span>    <span class="va">tb_where_state</span>,</span>
<span>    <span class="va">tb_where_county</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">st_mrs_age_w11</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">mrs_age_definition</span><span class="op">(</span></span>
<span>    <span class="va">mrs_age_w11</span>,</span>
<span>    <span class="va">dm_mrs_age</span>,</span>
<span>    <span class="va">updates_st_mrs_age</span>,</span>
<span>    <span class="va">tb_who</span>,</span>
<span>    <span class="va">tb_where</span>,</span>
<span>    <span class="va">tb_where_state</span>,</span>
<span>    <span class="va">tb_where_county</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>Errors may occur because the data is different from the original,
especially in the dimension enrichment part, if data is missing. In this
case, we must eliminate from the function the lines corresponding to
enrichment and later try to enrich the dimension by checking the errors
with <code>enrich_dimension_import_test</code>.</p>
<p>Once we have the data in the same format, we can apply the
incremental refresh to the original star schema, as follows.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">st_mrs_age</span> <span class="op">&lt;-</span> <span class="va">st_mrs_age</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/incremental_refresh_star_schema.html">incremental_refresh_star_schema</a></span><span class="op">(</span><span class="va">st_mrs_age_w10</span>, existing <span class="op">=</span> <span class="st">"replace"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/incremental_refresh_star_schema.html">incremental_refresh_star_schema</a></span><span class="op">(</span><span class="va">st_mrs_age_w11</span>, existing <span class="op">=</span> <span class="st">"replace"</span><span class="op">)</span></span></code></pre></div>
<p>In this case, it has been assumed that if data from previous periods
appears among the new data, the new data has to replace the previous
data (value “replace” in <code>existing</code> parameter).</p>
<p>If the star schema has been integrated into a constellation, the
incremental refresh can be performed on it, as follows.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ct_mrs</span> <span class="op">&lt;-</span> <span class="va">ct_mrs</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/incremental_refresh_constellation.html">incremental_refresh_constellation</a></span><span class="op">(</span><span class="va">st_mrs_age_w10</span>, existing <span class="op">=</span> <span class="st">"replace"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/incremental_refresh_constellation.html">incremental_refresh_constellation</a></span><span class="op">(</span><span class="va">st_mrs_age_w11</span>, existing <span class="op">=</span> <span class="st">"replace"</span><span class="op">)</span></span></code></pre></div>
<p>In this case, the corresponding star schema, the conformed dimensions
and all the star schemas that share them are updated.</p>
</div>
<div class="section level4">
<h4 id="refresh-operations-for-data-according-to-cause">Refresh operations for data according to cause<a class="anchor" aria-label="anchor" href="#refresh-operations-for-data-according-to-cause"></a>
</h4>
<p>Similar to how it has been done for age data, it can be done for
cause data, as shown below.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mrs_cause_definition</span> <span class="op">&lt;-</span></span>
<span>  <span class="kw">function</span><span class="op">(</span><span class="va">ft</span>,</span>
<span>           <span class="va">dm</span>,</span>
<span>           <span class="va">updates</span>,</span>
<span>           <span class="va">tb_where</span>,</span>
<span>           <span class="va">tb_where_state</span>,</span>
<span>           <span class="va">tb_where_county</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="../reference/star_schema.html">star_schema</a></span><span class="op">(</span><span class="va">ft</span>, <span class="va">dm</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="../reference/snake_case.html">snake_case</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="../reference/character_dimensions.html">character_dimensions</a></span><span class="op">(</span></span>
<span>        NA_replacement_value <span class="op">=</span> <span class="st">"Unknown"</span>,</span>
<span>        length_integers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>          week <span class="op">=</span> <span class="fl">2</span>,</span>
<span>          data_availability_week <span class="op">=</span> <span class="fl">2</span>,</span>
<span>          reception_week <span class="op">=</span> <span class="fl">2</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="../reference/role_playing_dimension.html">role_playing_dimension</a></span><span class="op">(</span></span>
<span>        dim_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"when"</span>, <span class="st">"when_received"</span>, <span class="st">"when_available"</span><span class="op">)</span>,</span>
<span>        name <span class="op">=</span> <span class="st">"when_common"</span>,</span>
<span>        attributes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"date"</span>, <span class="st">"week"</span>, <span class="st">"year"</span><span class="op">)</span></span>
<span>      <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="../reference/rename_dimension_attributes.html">rename_dimension_attributes</a></span><span class="op">(</span></span>
<span>        name <span class="op">=</span> <span class="st">"when"</span>,</span>
<span>        attributes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"week_ending_date"</span>, <span class="st">"week"</span>, <span class="st">"year"</span><span class="op">)</span>,</span>
<span>        new_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>          <span class="st">"when_happened_date"</span>,</span>
<span>          <span class="st">"when_happened_week"</span>,</span>
<span>          <span class="st">"when_happened_year"</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="../reference/rename_dimension_attributes.html">rename_dimension_attributes</a></span><span class="op">(</span></span>
<span>        name <span class="op">=</span> <span class="st">"where"</span>,</span>
<span>        attributes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"region"</span><span class="op">)</span>,</span>
<span>        new_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"division"</span><span class="op">)</span></span>
<span>      <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="../reference/modify_dimension_records.html">modify_dimension_records</a></span><span class="op">(</span><span class="va">updates</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="../reference/enrich_dimension_import.html">enrich_dimension_import</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"where"</span>, <span class="va">tb_where</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="../reference/enrich_dimension_import.html">enrich_dimension_import</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"where"</span>, <span class="va">tb_where_state</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="../reference/enrich_dimension_import.html">enrich_dimension_import</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"where"</span>, <span class="va">tb_where_county</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span><span class="va">st_mrs_cause_w10</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">mrs_cause_definition</span><span class="op">(</span></span>
<span>    <span class="va">mrs_cause_w10</span>,</span>
<span>    <span class="va">dm_mrs_cause</span>,</span>
<span>    <span class="va">updates_st_mrs_age</span>,</span>
<span>    <span class="va">tb_where</span>,</span>
<span>    <span class="va">tb_where_state</span>,</span>
<span>    <span class="va">tb_where_county</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">st_mrs_cause_w11</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">mrs_cause_definition</span><span class="op">(</span></span>
<span>    <span class="va">mrs_cause_w11</span>,</span>
<span>    <span class="va">dm_mrs_cause</span>,</span>
<span>    <span class="va">updates_st_mrs_age</span>,</span>
<span>    <span class="va">tb_where</span>,</span>
<span>    <span class="va">tb_where_state</span>,</span>
<span>    <span class="va">tb_where_county</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">st_mrs_cause</span> <span class="op">&lt;-</span> <span class="va">st_mrs_cause</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/incremental_refresh_star_schema.html">incremental_refresh_star_schema</a></span><span class="op">(</span><span class="va">st_mrs_cause_w10</span>, existing <span class="op">=</span> <span class="st">"group"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/incremental_refresh_star_schema.html">incremental_refresh_star_schema</a></span><span class="op">(</span><span class="va">st_mrs_cause_w11</span>, existing <span class="op">=</span> <span class="st">"group"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ct_mrs</span> <span class="op">&lt;-</span> <span class="va">ct_mrs</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/incremental_refresh_constellation.html">incremental_refresh_constellation</a></span><span class="op">(</span><span class="va">st_mrs_cause_w10</span>, existing <span class="op">=</span> <span class="st">"group"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/incremental_refresh_constellation.html">incremental_refresh_constellation</a></span><span class="op">(</span><span class="va">st_mrs_cause_w11</span>, existing <span class="op">=</span> <span class="st">"group"</span><span class="op">)</span></span></code></pre></div>
<p>In this case, the previously existing data is treated differently
than it was in the previous case, now what is done is grouping it using
the defined aggregation functions, assuming it is additional data that
has not been entered before (value “group” in <code>existing</code>
parameter).</p>
</div>
<div class="section level4">
<h4 id="filter-and-purge-operations">Filter and purge operations<a class="anchor" aria-label="anchor" href="#filter-and-purge-operations"></a>
</h4>
<p>Sometimes the data refresh consists of eliminating data that is no
longer necessary, generally because it corresponds to a period that has
stopped being analysed but it can also be for other reasons. In general,
they can be selected considering any combination of dimensions, not just
the time dimension.</p>
<p>Suppose we want to delete the <em>Boston</em> data working at the
constellation level. First, we select them considering the stars that
make up the constellation.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">st1</span> <span class="op">&lt;-</span> <span class="va">ct_mrs</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/get_star_schema.html">get_star_schema</a></span><span class="op">(</span><span class="st">"mrs_age"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/filter_fact_rows.html">filter_fact_rows</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"where"</span>, <span class="va">city</span> <span class="op">==</span> <span class="st">"Boston"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">st2</span> <span class="op">&lt;-</span> <span class="va">ct_mrs</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/get_star_schema.html">get_star_schema</a></span><span class="op">(</span><span class="st">"mrs_cause"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/filter_fact_rows.html">filter_fact_rows</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"where"</span>, <span class="va">city</span> <span class="op">==</span> <span class="st">"Boston"</span><span class="op">)</span></span></code></pre></div>
<p>We can work both at the star or constellation level. In this example,
we are going to do it at the constellation level (working on a temporary
variable so as not to lose data), as we have been doing.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ct_tmp</span> <span class="op">&lt;-</span> <span class="va">ct_mrs</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/incremental_refresh_constellation.html">incremental_refresh_constellation</a></span><span class="op">(</span><span class="va">st1</span>, existing <span class="op">=</span> <span class="st">"delete"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/incremental_refresh_constellation.html">incremental_refresh_constellation</a></span><span class="op">(</span><span class="va">st2</span>, existing <span class="op">=</span> <span class="st">"delete"</span><span class="op">)</span></span></code></pre></div>
<p>These operations have only removed the fact data. The first records
of the <code>where</code> dimension are shown below.</p>
<table style="width:100%;" class="table">
<colgroup>
<col width="10%">
<col width="9%">
<col width="7%">
<col width="11%">
<col width="14%">
<col width="8%">
<col width="12%">
<col width="14%">
<col width="10%">
</colgroup>
<thead><tr class="header">
<th align="center">where_key</th>
<th align="center">division</th>
<th align="center">state</th>
<th align="center">city</th>
<th align="center">division_name</th>
<th align="center">region</th>
<th align="center">region_name</th>
<th align="center">state_name</th>
<th align="center">county</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">1</td>
<td align="center">1</td>
<td align="center">CT</td>
<td align="center">Bridgeport</td>
<td align="center">New England</td>
<td align="center">1</td>
<td align="center">Northeast</td>
<td align="center">Connecticut</td>
<td align="center">Fairfield</td>
</tr>
<tr class="even">
<td align="center">2</td>
<td align="center">1</td>
<td align="center">CT</td>
<td align="center">Hartford</td>
<td align="center">New England</td>
<td align="center">1</td>
<td align="center">Northeast</td>
<td align="center">Connecticut</td>
<td align="center">Hartford</td>
</tr>
<tr class="odd">
<td align="center">3</td>
<td align="center">1</td>
<td align="center">CT</td>
<td align="center">New Haven</td>
<td align="center">New England</td>
<td align="center">1</td>
<td align="center">Northeast</td>
<td align="center">Connecticut</td>
<td align="center">New Haven</td>
</tr>
<tr class="even">
<td align="center">4</td>
<td align="center">1</td>
<td align="center">CT</td>
<td align="center">Waterbury</td>
<td align="center">New England</td>
<td align="center">1</td>
<td align="center">Northeast</td>
<td align="center">Connecticut</td>
<td align="center">New Haven</td>
</tr>
<tr class="odd">
<td align="center">5</td>
<td align="center">1</td>
<td align="center">MA</td>
<td align="center">Boston</td>
<td align="center">New England</td>
<td align="center">1</td>
<td align="center">Northeast</td>
<td align="center">Massachusetts</td>
<td align="center">Suffolk</td>
</tr>
<tr class="even">
<td align="center">6</td>
<td align="center">1</td>
<td align="center">MA</td>
<td align="center">Cambridge</td>
<td align="center">New England</td>
<td align="center">1</td>
<td align="center">Northeast</td>
<td align="center">Massachusetts</td>
<td align="center">Middlesex</td>
</tr>
</tbody>
</table>
<p>Once the fact data is removed, we can remove the data for the
dimensions that are no longer needed using the following function.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ct_tmp</span> <span class="op">&lt;-</span> <span class="va">ct_tmp</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/purge_dimensions_constellation.html">purge_dimensions_constellation</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>The result in the <code>where</code> dimension is shown below.</p>
<table style="width:100%;" class="table">
<colgroup>
<col width="10%">
<col width="9%">
<col width="7%">
<col width="11%">
<col width="14%">
<col width="8%">
<col width="12%">
<col width="14%">
<col width="10%">
</colgroup>
<thead><tr class="header">
<th align="center">where_key</th>
<th align="center">division</th>
<th align="center">state</th>
<th align="center">city</th>
<th align="center">division_name</th>
<th align="center">region</th>
<th align="center">region_name</th>
<th align="center">state_name</th>
<th align="center">county</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">1</td>
<td align="center">1</td>
<td align="center">CT</td>
<td align="center">Bridgeport</td>
<td align="center">New England</td>
<td align="center">1</td>
<td align="center">Northeast</td>
<td align="center">Connecticut</td>
<td align="center">Fairfield</td>
</tr>
<tr class="even">
<td align="center">2</td>
<td align="center">1</td>
<td align="center">CT</td>
<td align="center">Hartford</td>
<td align="center">New England</td>
<td align="center">1</td>
<td align="center">Northeast</td>
<td align="center">Connecticut</td>
<td align="center">Hartford</td>
</tr>
<tr class="odd">
<td align="center">3</td>
<td align="center">1</td>
<td align="center">CT</td>
<td align="center">New Haven</td>
<td align="center">New England</td>
<td align="center">1</td>
<td align="center">Northeast</td>
<td align="center">Connecticut</td>
<td align="center">New Haven</td>
</tr>
<tr class="even">
<td align="center">4</td>
<td align="center">1</td>
<td align="center">CT</td>
<td align="center">Waterbury</td>
<td align="center">New England</td>
<td align="center">1</td>
<td align="center">Northeast</td>
<td align="center">Connecticut</td>
<td align="center">New Haven</td>
</tr>
<tr class="odd">
<td align="center">5</td>
<td align="center">1</td>
<td align="center">MA</td>
<td align="center">Cambridge</td>
<td align="center">New England</td>
<td align="center">1</td>
<td align="center">Northeast</td>
<td align="center">Massachusetts</td>
<td align="center">Middlesex</td>
</tr>
<tr class="even">
<td align="center">6</td>
<td align="center">1</td>
<td align="center">MA</td>
<td align="center">Fall River</td>
<td align="center">New England</td>
<td align="center">1</td>
<td align="center">Northeast</td>
<td align="center">Massachusetts</td>
<td align="center">Bristol</td>
</tr>
</tbody>
</table>
<p>The <em>Boston</em> data has disappeared and the surrogate keys have
been reassigned (on the temporary variable).</p>
</div>
</div>
<div class="section level3">
<h3 id="exporting-results">Exporting results<a class="anchor" aria-label="anchor" href="#exporting-results"></a>
</h3>
<p>Once we have made the necessary definitions and transformations, we
can export the data to work in a database or with a query tool.</p>
<p>Instead of exporting data in the specific format of a particular
tool, it is exported as <code>tibble</code>-based structures that can be
easily handled.</p>
<div class="section level4">
<h4 id="star-schema">Star schema<a class="anchor" aria-label="anchor" href="#star-schema"></a>
</h4>
<p>Various export possibilities are offered. Specifically, for a star
schema one of them is to export the data as a flat table. The main
difference from the initial data is that we have cleaned and conformed
it. This operation is offered for completeness. To work only with flat
tables, this package is not suitable.</p>
<p>To work with databases, it is useful to be able to export a star
schema as a list of <code>tibble</code> with dimension and fact tables,
as shown below.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tl</span> <span class="op">&lt;-</span> <span class="va">st_mrs_age</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/star_schema_as_tibble_list.html">star_schema_as_tibble_list</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Optionally, the export function allows the role playing dimensions to
be included.</p>
</div>
<div class="section level4">
<h4 id="constellation">Constellation<a class="anchor" aria-label="anchor" href="#constellation"></a>
</h4>
<p>To export constellation data, as well as a <code>tibble</code> list,
the <code>multistar</code> format may be interesting, where you have a
list of <code>tibble</code> for fact tables and another for dimension
tables.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ms_mrs</span> <span class="op">&lt;-</span> <span class="va">ct_mrs</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/constellation_as_multistar.html">constellation_as_multistar</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="multistar">
<code>multistar</code><a class="anchor" aria-label="anchor" href="#multistar"></a>
</h4>
<p>We can obtain a flat table, implemented using a <code>tibble</code>,
from a <code>multistar</code> (which can be the result of a query). If
it only has one fact table, it is not necessary to provide its name.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ft</span> <span class="op">&lt;-</span> <span class="va">ms_mrs</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/multistar_as_flat_table.html">multistar_as_flat_table</a></span><span class="op">(</span>fact <span class="op">=</span> <span class="st">"mrs_age"</span><span class="op">)</span></span></code></pre></div>
<p>The first rows of the flat table obtained as a result are shown
below.</p>
<table style="width:100%;" class="table">
<colgroup>
<col width="4%">
<col width="5%">
<col width="3%">
<col width="2%">
<col width="4%">
<col width="5%">
<col width="3%">
<col width="4%">
<col width="4%">
<col width="4%">
<col width="8%">
<col width="8%">
<col width="8%">
<col width="7%">
<col width="7%">
<col width="7%">
<col width="3%">
<col width="3%">
</colgroup>
<thead><tr class="header">
<th align="center">age_range</th>
<th align="center">wide_age_range</th>
<th align="center">division</th>
<th align="center">state</th>
<th align="center">city</th>
<th align="center">division_name</th>
<th align="center">region</th>
<th align="center">region_name</th>
<th align="center">state_name</th>
<th align="center">county</th>
<th align="center">data_availability_date</th>
<th align="center">data_availability_week</th>
<th align="center">data_availability_year</th>
<th align="center">when_happened_date</th>
<th align="center">when_happened_week</th>
<th align="center">when_happened_year</th>
<th align="center">n_deaths</th>
<th align="center">nrow_agg</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">1: &lt;1 year</td>
<td align="center">0-24 years</td>
<td align="center">1</td>
<td align="center">CT</td>
<td align="center">Bridgeport</td>
<td align="center">New England</td>
<td align="center">1</td>
<td align="center">Northeast</td>
<td align="center">Connecticut</td>
<td align="center">Fairfield</td>
<td align="center">1962-01-15</td>
<td align="center">03</td>
<td align="center">1962</td>
<td align="center">1962-01-06</td>
<td align="center">01</td>
<td align="center">1962</td>
<td align="center">3</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">1: &lt;1 year</td>
<td align="center">0-24 years</td>
<td align="center">1</td>
<td align="center">CT</td>
<td align="center">Bridgeport</td>
<td align="center">New England</td>
<td align="center">1</td>
<td align="center">Northeast</td>
<td align="center">Connecticut</td>
<td align="center">Fairfield</td>
<td align="center">1962-01-17</td>
<td align="center">03</td>
<td align="center">1962</td>
<td align="center">1962-01-13</td>
<td align="center">02</td>
<td align="center">1962</td>
<td align="center">1</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">1: &lt;1 year</td>
<td align="center">0-24 years</td>
<td align="center">1</td>
<td align="center">CT</td>
<td align="center">Bridgeport</td>
<td align="center">New England</td>
<td align="center">1</td>
<td align="center">Northeast</td>
<td align="center">Connecticut</td>
<td align="center">Fairfield</td>
<td align="center">1962-01-23</td>
<td align="center">04</td>
<td align="center">1962</td>
<td align="center">1962-01-20</td>
<td align="center">03</td>
<td align="center">1962</td>
<td align="center">5</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">1: &lt;1 year</td>
<td align="center">0-24 years</td>
<td align="center">1</td>
<td align="center">CT</td>
<td align="center">Bridgeport</td>
<td align="center">New England</td>
<td align="center">1</td>
<td align="center">Northeast</td>
<td align="center">Connecticut</td>
<td align="center">Fairfield</td>
<td align="center">1962-01-28</td>
<td align="center">04</td>
<td align="center">1962</td>
<td align="center">1962-01-27</td>
<td align="center">04</td>
<td align="center">1962</td>
<td align="center">3</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">1: &lt;1 year</td>
<td align="center">0-24 years</td>
<td align="center">1</td>
<td align="center">CT</td>
<td align="center">Bridgeport</td>
<td align="center">New England</td>
<td align="center">1</td>
<td align="center">Northeast</td>
<td align="center">Connecticut</td>
<td align="center">Fairfield</td>
<td align="center">1962-02-05</td>
<td align="center">06</td>
<td align="center">1962</td>
<td align="center">1962-02-03</td>
<td align="center">05</td>
<td align="center">1962</td>
<td align="center">6</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">1: &lt;1 year</td>
<td align="center">0-24 years</td>
<td align="center">1</td>
<td align="center">CT</td>
<td align="center">Bridgeport</td>
<td align="center">New England</td>
<td align="center">1</td>
<td align="center">Northeast</td>
<td align="center">Connecticut</td>
<td align="center">Fairfield</td>
<td align="center">1962-02-23</td>
<td align="center">08</td>
<td align="center">1962</td>
<td align="center">1962-02-10</td>
<td align="center">06</td>
<td align="center">1962</td>
<td align="center">3</td>
<td align="center">1</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section level3">
<h3 id="query-functions">Query functions<a class="anchor" aria-label="anchor" href="#query-functions"></a>
</h3>
<p>The main motivation of the query functions of this package is to have
the possibility to select subsets of data to be exported or presented
through other packages.</p>
<p>We can define queries on data in <code>multistar</code> format. Data
in this format can be obtained from a star or a constellation.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ms_mrs</span> <span class="op">&lt;-</span> <span class="va">ct_mrs</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/constellation_as_multistar.html">constellation_as_multistar</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>The query is created using <code>dimensional_query</code> and
executed using <code>run_query.</code> We can refine it using
<code>select_dimension</code>, <code>select_fact</code> and
<code>filter_dimension</code> as much as we deem appropriate.</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ms</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dimensional_query.html">dimensional_query</a></span><span class="op">(</span><span class="va">ms_mrs</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/select_dimension.html">select_dimension</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"where"</span>,</span>
<span>                   attributes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"city"</span>, <span class="st">"state"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/select_dimension.html">select_dimension</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"when"</span>,</span>
<span>                   attributes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"when_happened_year"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/select_fact.html">select_fact</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"mrs_age"</span>,</span>
<span>              measures <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"n_deaths"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/select_fact.html">select_fact</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="st">"mrs_cause"</span>,</span>
<span>    measures <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pneumonia_and_influenza_deaths"</span>, <span class="st">"other_deaths"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/filter_dimension.html">filter_dimension</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"when"</span>, <span class="va">when_happened_week</span> <span class="op">&lt;=</span> <span class="st">"03"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/filter_dimension.html">filter_dimension</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"where"</span>, <span class="va">city</span> <span class="op">==</span> <span class="st">"Bridgeport"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/run_query.html">run_query</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>The result of a query is a <code>multistar</code> structure. In this
way, we can define queries on the result of others. The result can also
be transformed into a flat table.</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ft</span> <span class="op">&lt;-</span> <span class="va">ms</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/multistar_as_flat_table.html">multistar_as_flat_table</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>The content of the flat table is shown below.</p>
<table class="table">
<colgroup>
<col width="13%">
<col width="8%">
<col width="5%">
<col width="7%">
<col width="7%">
<col width="28%">
<col width="16%">
<col width="13%">
</colgroup>
<thead><tr class="header">
<th align="center">when_happened_year</th>
<th align="center">city</th>
<th align="center">state</th>
<th align="center">n_deaths</th>
<th align="center">nrow_agg</th>
<th align="center">mrs_cause_pneumonia_and_influenza_deaths</th>
<th align="center">mrs_cause_other_deaths</th>
<th align="center">mrs_cause_nrow_agg</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center">1962</td>
<td align="center">Bridgeport</td>
<td align="center">CT</td>
<td align="center">129</td>
<td align="center">12</td>
<td align="center">7</td>
<td align="center">122</td>
<td align="center">3</td>
</tr></tbody>
</table>
<p>In the result it can be seen that, as the query has been defined at
the year and city level, for a single city, with data available for a
single year, there is only one row. Columns <code>nrow_agg</code> and
<code>mrs_cause_nrow_agg</code> show the number of original rows that
make up the result row.</p>
<p>From the result in the form of a flat table, <a href="https://CRAN.R-project.org/package=pivottabler" class="external-link"><code>pivottabler</code></a>
package can be used to present it in the form of a pivot table.</p>
</div>
</div>
<div class="section level2">
<h2 id="conclusions">Conclusions<a class="anchor" aria-label="anchor" href="#conclusions"></a>
</h2>
<p><code>starschemar</code> package offers a set of operations that
allow us to transform flat tables into star schemas. Star schemas
support the definition of role playing and role dimensions. Additional
transformation operations can be applied to each star schema to adapt
the format of the data. From several star schemas you can define fact
constellation with conformed dimensions.</p>
<p>Cleaning and conforming data operations can be defined on the star
schemas and fact constellation. To update the data, incremental refresh
operations are offered, also applicable on said structures. In addition,
there are several possibilities to export the results obtained in the
form of easily treatable <code>tibble</code>-based structures.
Operations are also provided to query the multidimensional structure,
mainly for selecting the data to export.</p>
<p>Operations have been designed to be intuitive and easy to use. The
result greatly facilitates the data transformation process for the
exposed situation.</p>
</div>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-adamson2010star" class="csl-entry">
Adamson, Christopher. 2010. <em>Star Schema: The Complete
Reference</em>. McGraw Hill Professional.
</div>
<div id="ref-jensen2010multi" class="csl-entry">
Jensen, Christian S., Torben Bach Pedersen, and Christian Thomsen. 2010.
<em>Multidimensional Databases and Data Warehousing</em>. Morgan &amp;
Claypool Publishers.
</div>
<div id="ref-kimball2013data" class="csl-entry">
Kimball, Ralph, and Margy Ross. 2013. <em>The Data Warehouse Toolkit:
The Definitive Guide to Dimensional Modeling</em>. John Wiley &amp;
Sons.
</div>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Jose Samos.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
